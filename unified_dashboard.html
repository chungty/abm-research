<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verdigris ABM Intelligence Dashboard</title>
    <style>
        :root {
            /* Verdigris Brand Colors */
            --verdigris-primary: #00e5ff;
            --verdigris-accent: #ff7043;
            --verdigris-dark: #0a0a0a;
            --verdigris-surface: #1a1a1a;
            --verdigris-elevated: #2a2a2a;
            --verdigris-border: #3a3a3a;
            --verdigris-text: #ffffff;
            --verdigris-text-secondary: #b0b0b0;
            --verdigris-success: #4caf50;
            --verdigris-warning: #ff9800;
            --verdigris-error: #f44336;
            --verdigris-glow: rgba(0, 229, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--verdigris-dark);
            color: var(--verdigris-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .dashboard-container {
            min-height: 100vh;
        }

        /* Navigation Sidebar */
        .nav-sidebar {
            background: var(--verdigris-surface);
            border-right: 1px solid var(--verdigris-border);
            padding: 32px 24px;
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .logo-section {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 1px solid var(--verdigris-border);
            padding-bottom: 24px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--verdigris-primary), var(--verdigris-accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tagline {
            font-size: 11px;
            color: var(--verdigris-text-secondary);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: block;
            padding: 12px 16px;
            color: var(--verdigris-text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-link:hover,
        .nav-link.active {
            background: var(--verdigris-elevated);
            color: var(--verdigris-primary);
            box-shadow: 0 0 20px var(--verdigris-glow);
        }

        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 32px;
            background: var(--verdigris-dark);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--verdigris-border);
        }

        .header-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header-subtitle {
            color: var(--verdigris-text-secondary);
            font-size: 16px;
        }

        .refresh-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--verdigris-primary);
            color: var(--verdigris-dark);
        }

        .btn-primary:hover {
            background: #00d4e6;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--verdigris-glow);
        }

        .btn-secondary {
            background: var(--verdigris-elevated);
            color: var(--verdigris-text);
            border: 1px solid var(--verdigris-border);
        }

        .btn-secondary:hover {
            background: var(--verdigris-border);
            border-color: var(--verdigris-primary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--verdigris-surface);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--verdigris-primary), var(--verdigris-accent));
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--verdigris-primary);
            margin-bottom: 8px;
            text-shadow: 0 0 20px var(--verdigris-glow);
        }

        .stat-label {
            font-size: 14px;
            color: var(--verdigris-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 32px;
            margin-bottom: 32px;
        }

        .main-panel {
            background: var(--verdigris-surface);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            overflow: hidden;
        }

        .panel-header {
            padding: 24px;
            border-bottom: 1px solid var(--verdigris-border);
            background: var(--verdigris-elevated);
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .panel-subtitle {
            color: var(--verdigris-text-secondary);
            font-size: 14px;
        }

        .panel-content {
            padding: 0;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Contact Cards */
        .contact-card {
            padding: 24px;
            border-bottom: 1px solid var(--verdigris-border);
            transition: all 0.2s ease;
        }

        .contact-card:hover {
            background: var(--verdigris-elevated);
        }

        .contact-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .contact-basic {
            flex: 1;
        }

        .contact-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .contact-title {
            color: var(--verdigris-text-secondary);
            margin-bottom: 12px;
        }

        .contact-channels {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .channel-btn {
            padding: 6px 12px;
            border: 1px solid var(--verdigris-border);
            border-radius: 6px;
            color: var(--verdigris-text);
            text-decoration: none;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .channel-btn:hover {
            background: var(--verdigris-primary);
            color: var(--verdigris-dark);
            border-color: var(--verdigris-primary);
        }

        .lead-score {
            text-align: right;
            min-width: 120px;
        }

        .score-main {
            font-size: 28px;
            font-weight: 700;
            color: var(--verdigris-primary);
            margin-bottom: 4px;
        }

        .score-breakdown {
            font-size: 11px;
            color: var(--verdigris-text-secondary);
            line-height: 1.2;
        }

        .ai-recommendations {
            border-top: 1px solid var(--verdigris-border);
            padding-top: 16px;
            margin-top: 16px;
        }

        .recommendation-section {
            margin-bottom: 16px;
        }

        .recommendation-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--verdigris-primary);
            margin-bottom: 8px;
        }

        .recommendation-list {
            font-size: 13px;
            color: var(--verdigris-text-secondary);
            line-height: 1.4;
        }

        /* Signal Trend Analytics */
        .signal-trends {
            background: var(--verdigris-elevated);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--verdigris-border);
        }

        .trends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .trends-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--verdigris-text);
        }

        .trends-insight {
            font-size: 12px;
            color: var(--verdigris-secondary);
            background: rgba(255, 119, 0, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }

        .trend-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .trend-metric {
            background: var(--verdigris-surface);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            border: 1px solid var(--verdigris-border-light);
        }

        .metric-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--verdigris-primary);
            margin-bottom: 4px;
        }

        .metric-label {
            font-size: 11px;
            color: var(--verdigris-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .trend-chart {
            background: var(--verdigris-surface);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--verdigris-border-light);
        }

        .chart-title {
            font-size: 12px;
            font-weight: 500;
            color: var(--verdigris-text-secondary);
            margin-bottom: 12px;
        }

        .urgency-breakdown {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .urgency-bar {
            background: var(--verdigris-border);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            flex-grow: 1;
            margin: 0 12px;
        }

        .urgency-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444 0%, var(--verdigris-secondary) 50%, var(--verdigris-primary) 100%);
            border-radius: 3px;
        }

        /* Trigger Events */
        .trigger-event {
            padding: 20px;
            border-bottom: 1px solid var(--verdigris-border);
            transition: all 0.2s ease;
            position: relative;
        }

        .trigger-event:hover {
            background: var(--verdigris-elevated);
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .event-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            flex: 1;
        }

        .event-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .event-type {
            padding: 4px 8px;
            background: var(--verdigris-primary);
            color: var(--verdigris-dark);
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .urgency-high {
            background: var(--verdigris-error);
            color: white;
        }

        .urgency-medium {
            background: var(--verdigris-warning);
            color: var(--verdigris-dark);
        }

        .urgency-low {
            background: var(--verdigris-success);
            color: white;
        }

        .event-scores {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 12px;
        }

        .confidence-score,
        .relevance-score {
            color: var(--verdigris-text-secondary);
        }

        .source-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--verdigris-primary);
            text-decoration: none;
            font-size: 12px;
            transition: color 0.2s ease;
        }

        .source-link:hover {
            color: var(--verdigris-accent);
        }

        /* Partnership Cards */
        .partnership-card {
            padding: 20px;
            border-bottom: 1px solid var(--verdigris-border);
            position: relative;
        }

        .partnership-card.high-relevance {
            border-left: 4px solid var(--verdigris-primary);
            background: linear-gradient(90deg, rgba(0, 229, 255, 0.03) 0%, transparent 100%);
        }

        .partnership-card.medium-relevance {
            border-left: 4px solid var(--verdigris-accent);
            background: linear-gradient(90deg, rgba(255, 165, 0, 0.03) 0%, transparent 100%);
        }

        .partnership-card.low-relevance {
            border-left: 4px solid var(--verdigris-border);
        }

        .partnership-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .partner-relevance {
            margin-bottom: 8px;
        }

        .relevance-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            background: var(--verdigris-surface);
            color: var(--verdigris-text-secondary);
        }

        /* Partnership Insights Section */
        .insights-section {
            margin: 24px 0;
        }

        .insights-panel {
            background: var(--verdigris-surface);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            padding: 24px;
        }

        .insights-title {
            color: var(--verdigris-text);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insights-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .insight-item {
            background: var(--verdigris-elevated);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid var(--verdigris-border);
        }

        .insight-item strong {
            color: var(--verdigris-primary);
            font-weight: 600;
            display: block;
            margin-bottom: 6px;
        }

        .partnerships-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 16px;
            margin-top: 24px;
        }

        .partner-name {
            font-weight: 600;
            font-size: 16px;
        }

        .partner-category {
            padding: 4px 8px;
            background: var(--verdigris-accent);
            color: white;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .opportunity-text {
            font-size: 13px;
            color: var(--verdigris-text-secondary);
            margin-bottom: 8px;
            line-height: 1.4;
        }


        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--verdigris-border);
            border-radius: 50%;
            border-top-color: var(--verdigris-primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        /* MOBILE OPTIMIZATION FOR ABM WORKFLOWS                                           */
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* Tablet and Desktop Responsive */
        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .dashboard-container {
                grid-template-columns: 250px 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        /* Mobile Responsive - Core ABM Functionality */
        @media (max-width: 768px) {
            /* Dashboard Layout Mobile Optimization */
            .dashboard-container {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .nav-sidebar {
                position: static;
                height: auto;
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--verdigris-border);
                padding: 15px;
            }

            .main-content {
                margin-left: 0;
                padding: 15px;
            }

            /* Header Mobile Optimization */
            .header {
                padding: 15px;
                text-align: center;
            }

            .header h1 {
                font-size: 20px;
                margin-bottom: 8px;
            }

            .header .subtitle {
                font-size: 12px;
            }

            /* Stats Grid Mobile Layout */
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                margin-bottom: 20px;
            }

            .stat-card {
                padding: 12px;
                text-align: center;
            }

            .stat-value {
                font-size: 20px;
            }

            .stat-label {
                font-size: 10px;
            }

            /* Content Grid Mobile Stack */
            .content-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            /* Navigation Mobile Optimization */
            .nav-sections {
                display: none; /* Hide navigation sections on mobile for space */
            }

            .nav-section {
                margin-bottom: 15px;
            }

            .nav-section h3 {
                font-size: 14px;
                margin-bottom: 8px;
            }

            /* Mobile Navigation Toggle */
            .mobile-nav-toggle {
                display: block;
                background: var(--verdigris-primary);
                color: var(--verdigris-black);
                border: none;
                padding: 10px 15px;
                border-radius: 6px;
                font-weight: 500;
                margin-bottom: 10px;
                cursor: pointer;
                width: 100%;
            }

            .mobile-nav-toggle:hover {
                background: var(--verdigris-secondary);
            }

            .nav-sections.mobile-open {
                display: block;
                animation: slideDown 0.3s ease-out;
            }

            @keyframes slideDown {
                from {
                    opacity: 0;
                    transform: translateY(-10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Panel Mobile Optimization */
            .panel {
                margin-bottom: 16px;
                padding: 16px;
            }

            .panel h2 {
                font-size: 16px;
                margin-bottom: 12px;
            }

            /* Contact Cards Mobile Layout */
            .contact-card {
                padding: 16px;
                margin-bottom: 12px;
            }

            .contact-header {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .contact-basic {
                width: 100%;
            }

            .contact-name {
                font-size: 16px;
            }

            .contact-title {
                font-size: 12px;
            }

            .contact-channels {
                margin-top: 8px;
                flex-wrap: wrap;
                gap: 6px;
            }

            .channel-btn {
                padding: 6px 10px;
                font-size: 10px;
                border-radius: 4px;
            }

            .lead-score {
                width: 100%;
                text-align: center;
                margin-top: 12px;
            }

            .score-main {
                font-size: 20px;
            }

            .score-breakdown {
                font-size: 10px;
                margin-top: 4px;
            }

            /* MEDDIC Section Mobile */
            .meddic-section {
                padding: 12px;
                margin: 12px 0;
            }

            .meddic-title {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .meddic-item {
                padding: 4px 0;
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .meddic-label {
                font-size: 11px;
                min-width: auto;
                font-weight: 600;
                color: var(--verdigris-primary);
            }

            .meddic-value {
                font-size: 11px;
                margin-left: 0;
            }

            /* Signal Cards Mobile */
            .signal-card {
                padding: 14px;
                margin-bottom: 10px;
            }

            .signal-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .signal-urgency {
                padding: 4px 8px;
                font-size: 10px;
                margin-bottom: 8px;
                align-self: flex-start;
            }

            .signal-description {
                font-size: 12px;
                line-height: 1.4;
            }

            .signal-meta {
                font-size: 10px;
                margin-top: 8px;
            }

            /* Next Actions Mobile */
            .next-actions-panel {
                padding: 16px;
                margin-bottom: 16px;
            }

            .next-actions-title {
                font-size: 16px;
                margin-bottom: 16px;
            }

            .action-category {
                margin-bottom: 16px;
            }

            .category-title {
                font-size: 14px;
                padding: 8px 12px;
                margin-bottom: 8px;
            }

            .action-item {
                padding: 12px;
                margin-bottom: 8px;
            }

            .action-header {
                flex-direction: column;
                gap: 6px;
                align-items: flex-start;
            }

            .action-title {
                font-size: 13px;
                line-height: 1.3;
            }

            .action-badge {
                padding: 3px 8px;
                font-size: 9px;
                align-self: flex-start;
            }

            .action-description {
                font-size: 11px;
                line-height: 1.4;
                margin-top: 6px;
            }

            .action-meta {
                font-size: 10px;
                margin-top: 6px;
            }

            /* Research Progress Mobile */
            .research-progress-panel {
                padding: 16px;
                margin-bottom: 16px;
            }

            .research-phases {
                gap: 12px;
            }

            .research-phase {
                padding: 12px;
            }

            .phase-header {
                flex-direction: column;
                gap: 6px;
                align-items: flex-start;
            }

            .phase-name {
                font-size: 12px;
            }

            .phase-status {
                padding: 3px 8px;
                font-size: 10px;
                align-self: flex-start;
            }

            .phase-progress {
                margin-top: 8px;
            }

            .progress-bar-container {
                height: 6px;
            }

            /* Partnership Cards Mobile */
            .partnership-card {
                padding: 14px;
                margin-bottom: 10px;
            }

            .partnership-header {
                flex-direction: column;
                gap: 8px;
                align-items: flex-start;
            }

            .partnership-company {
                font-size: 14px;
            }

            .partnership-type {
                padding: 4px 8px;
                font-size: 10px;
                align-self: flex-start;
            }

            /* Mobile-Specific Utilities */
            .mobile-hidden {
                display: none !important;
            }

            .mobile-center {
                text-align: center;
            }

            .mobile-stack {
                flex-direction: column !important;
                gap: 8px !important;
            }

            /* Touch-Friendly Interactions */
            .contact-card,
            .signal-card,
            .partnership-card,
            .action-item {
                cursor: pointer;
                transition: transform 0.1s ease, box-shadow 0.1s ease;
            }

            .contact-card:active,
            .signal-card:active,
            .partnership-card:active,
            .action-item:active {
                transform: scale(0.98);
                box-shadow: 0 2px 8px rgba(0, 229, 255, 0.15);
            }

            /* Mobile Button Optimization */
            .channel-btn,
            .action-badge,
            .signal-urgency {
                min-height: 32px; /* Touch target size */
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Small Mobile Devices */
        @media (max-width: 480px) {
            .main-content {
                padding: 12px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .stat-card {
                padding: 16px;
            }

            .contact-card,
            .signal-card,
            .action-item {
                padding: 14px;
            }

            .panel {
                padding: 14px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header .subtitle {
                font-size: 11px;
            }

            /* Compact MEDDIC for very small screens */
            .meddic-data {
                gap: 6px;
            }

            .meddic-item {
                padding: 3px 0;
            }

            /* Compact Next Actions */
            .action-item {
                padding: 10px;
            }

            .action-title {
                font-size: 12px;
            }

            .action-description {
                font-size: 10px;
            }
        }

        /* Mobile Navigation Toggle (Hidden by default) */
        .mobile-nav-toggle {
            display: none;
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active {
            background: var(--verdigris-success);
            box-shadow: 0 0 6px var(--verdigris-success);
        }

        .status-pending {
            background: var(--verdigris-warning);
        }

        .status-error {
            background: var(--verdigris-error);
        }

        /* Error States */
        .error-message {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--verdigris-error);
            color: var(--verdigris-error);
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--verdigris-text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Account Portfolio View Styles */
        .accounts-section {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        /* Research Progress Visualization */
        .research-progress-panel {
            background: var(--verdigris-surface);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .research-progress-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--verdigris-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .research-progress-subtitle {
            color: var(--verdigris-text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .research-phases {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .research-phase {
            background: var(--verdigris-elevated);
            border: 1px solid var(--verdigris-border-light);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s ease;
        }

        .research-phase:hover {
            border-color: var(--verdigris-primary);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 229, 255, 0.1);
        }

        .research-phase.completed {
            border-color: var(--verdigris-primary);
            background: rgba(0, 229, 255, 0.05);
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .phase-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .phase-name {
            font-weight: 500;
            font-size: 14px;
            color: var(--verdigris-text);
        }

        .phase-progress-bar {
            width: 100%;
            height: 6px;
            background: var(--verdigris-surface-dark);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .phase-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--verdigris-primary), var(--verdigris-primary-light));
            border-radius: 3px;
            transition: width 0.3s ease;
            position: relative;
        }

        .phase-progress-fill.completed {
            background: linear-gradient(90deg, var(--verdigris-primary), #66ff99);
        }

        .phase-progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 20px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3));
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .phase-completion {
            font-size: 12px;
            color: var(--verdigris-text-secondary);
            text-align: right;
        }

        .phase-completion.completed {
            color: var(--verdigris-primary);
            font-weight: 500;
        }

        .overall-progress {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--verdigris-border);
        }

        .overall-progress-text {
            font-size: 14px;
            color: var(--verdigris-text-secondary);
            margin-bottom: 8px;
            text-align: center;
        }

        .overall-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--verdigris-surface-dark);
            border-radius: 4px;
            overflow: hidden;
        }

        .overall-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--verdigris-primary), var(--verdigris-secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* ACCOUNT PLAN MODAL STYLES */
        .account-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 1000;
            overflow: hidden;
        }

        .account-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .account-modal-content {
            background: var(--verdigris-surface);
            border-radius: 16px;
            border: 2px solid var(--verdigris-primary);
            width: 95%;
            max-width: 1200px;
            height: 90%;
            max-height: 900px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 229, 255, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .account-modal-header {
            background: linear-gradient(135deg, var(--verdigris-dark) 0%, #002233 100%);
            padding: 24px;
            border-bottom: 2px solid var(--verdigris-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .account-modal-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--verdigris-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .account-modal-close {
            background: none;
            border: 2px solid var(--verdigris-primary);
            color: var(--verdigris-primary);
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .account-modal-close:hover {
            background: var(--verdigris-primary);
            color: var(--verdigris-dark);
            transform: scale(1.05);
        }

        .account-modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            background: var(--verdigris-surface);
        }

        /* Account Plan Content Layout */
        .account-plan-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 24px;
            height: 100%;
        }

        .account-plan-section {
            background: var(--verdigris-elevated);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            padding: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .account-plan-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--verdigris-primary);
            margin: 0 0 16px 0;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--verdigris-border);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .account-plan-section-content {
            flex: 1;
            overflow-y: auto;
        }

        /* Account Overview Section */
        .account-overview {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .account-overview .account-plan-section {
            margin: 0;
        }

        /* Contact Cards in Modal */
        .account-contact-item {
            background: var(--verdigris-surface-dark);
            border: 1px solid var(--verdigris-border-light);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: transform 0.2s ease;
        }

        .account-contact-item:hover {
            transform: translateX(4px);
            border-color: var(--verdigris-primary);
        }

        .account-contact-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--verdigris-text);
            margin-bottom: 4px;
        }

        .account-contact-title {
            font-size: 14px;
            color: var(--verdigris-text-secondary);
            margin-bottom: 8px;
        }

        .account-contact-score {
            font-size: 12px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .score-high {
            background: rgba(0, 229, 255, 0.2);
            color: var(--verdigris-primary);
            border: 1px solid var(--verdigris-primary);
        }

        .score-medium {
            background: rgba(255, 165, 0, 0.2);
            color: #ffaa00;
            border: 1px solid #ffaa00;
        }

        .score-low {
            background: rgba(128, 128, 128, 0.2);
            color: #888;
            border: 1px solid #666;
        }

        /* Signal/Event Items in Modal */
        .account-signal-item {
            background: var(--verdigris-surface-dark);
            border: 1px solid var(--verdigris-border-light);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid transparent;
        }

        .signal-high {
            border-left-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }

        .signal-medium {
            border-left-color: #ffaa00;
            background: rgba(255, 170, 0, 0.1);
        }

        .signal-low {
            border-left-color: #888;
            background: rgba(136, 136, 136, 0.1);
        }

        .account-signal-description {
            font-size: 14px;
            color: var(--verdigris-text);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .account-signal-meta {
            font-size: 12px;
            color: var(--verdigris-text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Partnership Items in Modal */
        .account-partnership-item {
            background: var(--verdigris-surface-dark);
            border: 1px solid var(--verdigris-border-light);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .account-partnership-type {
            font-size: 14px;
            font-weight: 600;
            color: var(--verdigris-secondary);
            margin-bottom: 4px;
        }

        .account-partnership-relevance {
            font-size: 12px;
            color: var(--verdigris-text-secondary);
            line-height: 1.4;
        }

        /* Account Stats Mini Cards */
        .account-stat-mini {
            text-align: center;
        }

        .account-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--verdigris-primary);
            margin-bottom: 4px;
        }

        .account-stat-label {
            font-size: 12px;
            color: var(--verdigris-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--verdigris-border);
            border-radius: 50%;
            border-top-color: var(--verdigris-primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* MEDDIC Section Styles */
        .meddic-section {
            background: var(--verdigris-elevated);
            border: 1px solid var(--verdigris-border);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }

        .meddic-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--verdigris-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .meddic-title::before {
            content: 'üéØ';
            font-size: 12px;
        }

        .meddic-data {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .meddic-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 0;
            border-bottom: 1px solid var(--verdigris-border-light);
        }

        .meddic-item:last-child {
            border-bottom: none;
        }

        .meddic-item.meddic-pain {
            flex-direction: column;
            align-items: flex-start;
            gap: 4px;
        }

        .meddic-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--verdigris-text-secondary);
            min-width: 65px;
            flex-shrink: 0;
        }

        .meddic-value {
            font-size: 12px;
            color: var(--verdigris-text);
            font-weight: 500;
        }

        .meddic-value.meddic-role {
            background: rgba(0, 229, 255, 0.15);
            color: var(--verdigris-primary);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .meddic-value.meddic-influence {
            color: var(--verdigris-secondary);
        }

        .meddic-value.meddic-position {
            color: var(--verdigris-text);
            background: var(--verdigris-surface);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }

        .meddic-value.meddic-budget {
            color: #66ff99;
            font-weight: 600;
        }

        .meddic-item.meddic-pain .meddic-value {
            color: var(--verdigris-text-secondary);
            font-size: 11px;
            line-height: 1.3;
        }

        /* Next Actions Priority Panel */
        .next-actions-panel {
            background: var(--verdigris-surface);
            border: 1px solid var(--verdigris-border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .next-actions-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--verdigris-text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .next-actions-title::before {
            content: '‚ö°';
            color: var(--verdigris-secondary);
        }

        .next-actions-subtitle {
            color: var(--verdigris-text-secondary);
            font-size: 14px;
            margin-bottom: 20px;
        }

        .action-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .action-category {
            background: var(--verdigris-elevated);
            border: 1px solid var(--verdigris-border);
            border-radius: 8px;
            padding: 16px;
        }

        .action-category-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--verdigris-border-light);
        }

        .action-category-icon {
            font-size: 14px;
        }

        .action-category-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--verdigris-text);
        }

        .action-category-count {
            background: var(--verdigris-primary);
            color: var(--verdigris-bg);
            font-size: 11px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        .action-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .action-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--verdigris-border-light);
            border-radius: 6px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .action-item:hover {
            background: var(--verdigris-surface);
            border-color: var(--verdigris-primary);
            transform: translateX(4px);
        }

        .action-priority {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-top: 4px;
            flex-shrink: 0;
        }

        .action-priority.urgent {
            background: #ff4757;
            box-shadow: 0 0 8px rgba(255, 71, 87, 0.4);
        }

        .action-priority.high {
            background: var(--verdigris-secondary);
            box-shadow: 0 0 8px rgba(255, 165, 0, 0.4);
        }

        .action-priority.medium {
            background: var(--verdigris-primary);
        }

        .action-priority.low {
            background: var(--verdigris-text-secondary);
        }

        .action-content {
            flex: 1;
        }

        .action-title {
            font-weight: 500;
            font-size: 13px;
            color: var(--verdigris-text);
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .action-description {
            font-size: 11px;
            color: var(--verdigris-text-secondary);
            line-height: 1.3;
            margin-bottom: 6px;
        }

        .action-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 10px;
            color: var(--verdigris-text-secondary);
        }

        .action-contact {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-contact::before {
            content: 'üë§';
            font-size: 9px;
        }

        .action-urgency {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .action-urgency.urgent::before {
            content: 'üî•';
            font-size: 9px;
        }

        .action-urgency.high::before {
            content: '‚ö°';
            font-size: 9px;
        }

        .action-urgency.medium::before {
            content: '‚è∞';
            font-size: 9px;
        }

        .action-urgency.low::before {
            content: 'üìÖ';
            font-size: 9px;
        }

        .action-cta {
            background: var(--verdigris-primary);
            color: var(--verdigris-bg);
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 8px;
        }

        .action-cta:hover {
            background: var(--verdigris-primary-light);
            transform: translateY(-1px);
        }

        /* Research Hero Section */
        .research-hero {
            background: linear-gradient(135deg, var(--verdigris-dark) 0%, #002233 100%);
            border: 2px solid var(--verdigris-primary);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
            position: relative;
            box-shadow: 0 8px 32px rgba(0, 229, 255, 0.15);
            overflow: hidden;
        }

        .research-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--verdigris-primary), var(--verdigris-accent), var(--verdigris-primary));
            animation: research-pulse 3s ease-in-out infinite;
        }

        @keyframes research-pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .research-hero-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--verdigris-text-primary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .research-hero-subtitle {
            color: var(--verdigris-text-secondary);
            margin-bottom: 24px;
            font-size: 16px;
            line-height: 1.5;
        }

        .research-form {
            display: grid;
            grid-template-columns: 1fr 1fr 160px;
            gap: 16px;
            align-items: end;
        }

        .research-input-group {
            position: relative;
        }

        .research-input-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: var(--verdigris-text-primary);
            margin-bottom: 8px;
        }

        .research-input {
            width: 100%;
            padding: 14px 16px;
            background: var(--verdigris-elevated);
            border: 2px solid var(--verdigris-border);
            border-radius: 8px;
            color: var(--verdigris-text-primary);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .research-input:focus {
            outline: none;
            border-color: var(--verdigris-primary);
            box-shadow: 0 0 0 3px rgba(0, 229, 255, 0.1);
            background: var(--verdigris-surface);
        }

        .research-input::placeholder {
            color: var(--verdigris-text-secondary);
            font-weight: 400;
        }

        .research-btn {
            height: 50px;
            background: linear-gradient(135deg, var(--verdigris-primary) 0%, #0099cc 100%);
            border: none;
            border-radius: 8px;
            color: var(--verdigris-dark);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .research-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 229, 255, 0.3);
        }

        .research-btn:active {
            transform: translateY(0);
        }

        .research-btn:disabled {
            background: var(--verdigris-border);
            color: var(--verdigris-text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .research-status {
            margin-top: 16px;
            padding: 16px;
            background: var(--verdigris-elevated);
            border: 1px solid var(--verdigris-border);
            border-radius: 8px;
            display: none;
        }

        .research-status.active {
            display: block;
        }

        .research-status-title {
            font-weight: 600;
            color: var(--verdigris-text-primary);
            margin-bottom: 8px;
        }

        .research-progress-bar {
            width: 100%;
            height: 8px;
            background: var(--verdigris-border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .research-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--verdigris-primary), var(--verdigris-accent));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .research-status-text {
            font-size: 14px;
            color: var(--verdigris-text-secondary);
        }

        /* Research Hero Responsive */
        @media (max-width: 768px) {
            .research-form {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .research-hero {
                padding: 24px;
                margin: 16px 0;
            }

            .research-hero-title {
                font-size: 20px;
            }
        }

    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Navigation Sidebar -->
        <nav class="nav-sidebar">
            <div class="logo-section">
                <div class="logo">VERDIGRIS</div>
                <div class="tagline">Designed in Moffett Field, CA</div>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#dashboard" class="nav-link active" data-section="dashboard">üìä Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="#accounts" class="nav-link" data-section="accounts">üè¢ Accounts</a>
                </li>
                <li class="nav-item">
                    <a href="#contacts" class="nav-link" data-section="contacts">üë• Contacts</a>
                </li>
                <li class="nav-item">
                    <a href="#signals" class="nav-link" data-section="signals">üìà Buying Signals</a>
                </li>
                <li class="nav-item">
                    <a href="#partnerships" class="nav-link" data-section="partnerships">ü§ù Partnerships</a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Header -->
            <header class="dashboard-header">
                <div>
                    <h1 class="header-title">Account Intelligence Platform</h1>
                    <p class="header-subtitle">Account-Based Marketing Research & Analytics</p>
                </div>

                <div class="refresh-controls">
                    <span class="status-indicator status-active"></span>
                    <span id="last-updated">Loading...</span>
                    <button class="btn btn-secondary" onclick="refreshDashboard()">
                        üîÑ Refresh
                    </button>
                </div>
            </header>

            <!-- Research Hero Section -->
            <div class="research-hero">
                <div class="research-hero-title">
                    üîç Start ABM Research
                </div>
                <div class="research-hero-subtitle">
                    Enter a company name and domain to begin comprehensive account-based marketing research.
                    Our AI will verify the company, discover contacts, analyze LinkedIn activity, detect trigger events, and build a complete account intelligence profile.
                </div>

                <form class="research-form" id="research-form" onsubmit="startCompanyResearch(event)">
                    <div class="research-input-group">
                        <label class="research-input-label" for="company-name">Company Name</label>
                        <input
                            type="text"
                            id="company-name"
                            class="research-input"
                            placeholder="e.g., Acme Corp"
                            required
                        />
                    </div>

                    <div class="research-input-group">
                        <label class="research-input-label" for="company-domain">Company Domain</label>
                        <input
                            type="text"
                            id="company-domain"
                            class="research-input"
                            placeholder="e.g., acme.com"
                            pattern="[a-zA-Z0-9][a-zA-Z0-9\-]*\.[a-zA-Z]{2,}"
                            required
                        />
                    </div>

                    <button type="submit" class="research-btn" id="research-btn">
                        üöÄ Start Research
                    </button>
                </form>

                <div class="research-status" id="research-status">
                    <div class="research-status-title" id="research-status-title">
                        Initiating Research...
                    </div>
                    <div class="research-progress-bar">
                        <div class="research-progress-fill" id="research-progress-fill"></div>
                    </div>
                    <div class="research-status-text" id="research-status-text">
                        Preparing to research company information...
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-contacts">-</div>
                    <div class="stat-label">Total Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-priority-contacts">-</div>
                    <div class="stat-label">Priority Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-hot-signals">-</div>
                    <div class="stat-label">Hot Signals</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-active-triggers">-</div>
                    <div class="stat-label">Active Triggers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-strategic-partners">-</div>
                    <div class="stat-label">Strategic Partners</div>
                </div>
            </div>

            <!-- Research Progress Container -->
            <div id="research-progress-container"></div>

            <!-- Next Actions Priority Panel -->
            <div id="next-actions-container"></div>


            <!-- Main Content Grid -->
            <div class="content-grid">
                <!-- Priority Contacts Panel -->
                <div class="main-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Priority Contacts</h2>
                        <p class="panel-subtitle">High-scoring contacts with engagement intelligence</p>
                    </div>
                    <div class="panel-content" id="contacts-container">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <div>Loading priority contacts...</div>
                        </div>
                    </div>
                </div>

                <!-- Buying Signals Panel -->
                <div class="main-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">Buying Signals</h2>
                        <p class="panel-subtitle">Real-time trigger events and market intelligence</p>
                    </div>
                    <div class="panel-content" id="signals-container">
                        <div class="empty-state">
                            <div class="empty-state-icon">üìà</div>
                            <div>Loading buying signals...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Strategic Partnerships Panel -->
            <div class="main-panel">
                <div class="panel-header">
                    <h2 class="panel-title">Strategic Partnerships</h2>
                    <p class="panel-subtitle">Partner ecosystem and collaboration opportunities</p>
                </div>
                <div class="panel-content" id="partnerships-container">
                    <div class="empty-state">
                        <div class="empty-state-icon">ü§ù</div>
                        <div>Loading strategic partnerships...</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Dashboard state management
        let dashboardData = null;
        let activeResearchJob = null;
        let refreshInterval = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Verdigris ABM Dashboard');
            initializeNavigation();
            loadDashboardData();
            setupResearchForm();
            startAutoRefresh();
        });

        // Navigation handling
        function initializeNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Update active link
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // Handle section navigation
                    const section = this.getAttribute('data-section');
                    console.log(`Navigate to section: ${section}`);

                    // Clear auto-refresh when navigating away from dashboard
                    if (section !== 'dashboard' && refreshInterval) {
                        console.log('üîÑ Clearing auto-refresh interval for navigation');
                        clearInterval(refreshInterval);
                        refreshInterval = null;
                    }

                    showSection(section);
                });
            });
        }

        // Load dashboard data from API
        async function loadDashboardData() {
            try {
                console.log('üìä Loading dashboard data...');
                const response = await fetch('/api/data');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                dashboardData = await response.json();
                console.log('‚úÖ Dashboard data loaded:', dashboardData);

                updateUI();
                updateLastUpdated();

            } catch (error) {
                console.error('‚ùå Error loading dashboard data:', error);
                showError('Failed to load dashboard data: ' + error.message);
            }
        }

        // Update all UI elements with new data
        function updateUI() {
            if (!dashboardData) return;

            updateStats();
            updateResearchProgress();
            updateNextActions();
            updateContactsPanel();
            updateSignalsPanel();
            updatePartnershipsPanel();
        }

        // Update statistics cards
        function updateStats() {
            const stats = dashboardData.stats || {};

            setTextContent('stat-total-contacts', stats.total_contacts || 0);
            setTextContent('stat-priority-contacts', stats.priority_contacts || 0);
            setTextContent('stat-hot-signals', stats.hot_signals || 0);
            setTextContent('stat-active-triggers', stats.active_triggers || 0);
            setTextContent('stat-strategic-partners', stats.strategic_partners || 0);
        }

        // Update 5-Phase Research Progress visualization
        function updateResearchProgress() {
            const progressContainer = document.getElementById('research-progress-container');
            if (!progressContainer) return;

            const accounts = dashboardData.primary_account ? [dashboardData.primary_account] : [];
            const contacts = dashboardData.contacts || [];
            const triggerEvents = dashboardData.trigger_events || [];
            const partnerships = dashboardData.partnerships || [];

            // Calculate overall research progress across all phases
            const researchProgress = calculateResearchProgress(accounts, contacts, triggerEvents, partnerships);

            // Clear existing content
            progressContainer.innerHTML = '';

            // Create progress visualization
            const progressHeader = document.createElement('div');
            progressHeader.className = 'research-progress-header';

            const title = document.createElement('h3');
            title.textContent = 'ABM Research Progress';
            title.style.color = 'var(--verdigris-primary)';
            title.style.marginBottom = '16px';

            progressHeader.appendChild(title);

            // Create phases container
            const phasesContainer = document.createElement('div');
            phasesContainer.className = 'research-phases';

            researchProgress.phases.forEach((phase, index) => {
                const phaseElement = createPhaseElement(phase, index);
                phasesContainer.appendChild(phaseElement);
            });

            // Add overall completion bar
            const overallContainer = document.createElement('div');
            overallContainer.className = 'overall-progress';

            const overallLabel = document.createElement('div');
            overallLabel.textContent = `Overall Research Completion: ${researchProgress.overallCompletion}%`;
            overallLabel.style.fontSize = '14px';
            overallLabel.style.fontWeight = '500';
            overallLabel.style.marginBottom = '8px';

            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar-container';

            const progressFill = document.createElement('div');
            progressFill.className = 'progress-bar-fill';
            progressFill.style.width = `${researchProgress.overallCompletion}%`;

            progressBar.appendChild(progressFill);

            overallContainer.appendChild(overallLabel);
            overallContainer.appendChild(progressBar);

            progressContainer.appendChild(progressHeader);
            progressContainer.appendChild(phasesContainer);
            progressContainer.appendChild(overallContainer);
        }

        // Calculate research progress across all ABM phases
        function calculateResearchProgress(accounts, contacts, triggerEvents, partnerships) {
            const phases = [
                {
                    name: 'Contact Discovery',
                    icon: 'üîç',
                    completion: contacts.length > 0 ? 100 : 0,
                    description: `${contacts.length} contacts discovered`,
                    isComplete: contacts.length > 0
                },
                {
                    name: 'LinkedIn Enrichment',
                    icon: 'üíº',
                    completion: contacts.filter(c => c.linkedin_activity_score).length > 0 ?
                        Math.round((contacts.filter(c => c.linkedin_activity_score).length / Math.max(contacts.length, 1)) * 100) : 0,
                    description: `${contacts.filter(c => c.linkedin_activity_score).length}/${contacts.length} contacts enriched`,
                    isComplete: contacts.length > 0 && contacts.every(c => c.linkedin_activity_score)
                },
                {
                    name: 'Trigger Detection',
                    icon: 'üéØ',
                    completion: triggerEvents.length > 0 ? 100 : 0,
                    description: `${triggerEvents.length} trigger events detected`,
                    isComplete: triggerEvents.length > 0
                },
                {
                    name: 'Partnership Intel',
                    icon: 'ü§ù',
                    completion: partnerships.length > 0 ? 100 : 0,
                    description: `${partnerships.length} partnerships identified`,
                    isComplete: partnerships.length > 0
                },
                {
                    name: 'Lead Scoring',
                    icon: 'üìä',
                    completion: contacts.filter(c => c.final_lead_score).length > 0 ?
                        Math.round((contacts.filter(c => c.final_lead_score).length / Math.max(contacts.length, 1)) * 100) : 0,
                    description: `${contacts.filter(c => c.final_lead_score).length}/${contacts.length} contacts scored`,
                    isComplete: contacts.length > 0 && contacts.every(c => c.final_lead_score)
                }
            ];

            const overallCompletion = Math.round(phases.reduce((sum, phase) => sum + phase.completion, 0) / phases.length);

            return {
                phases,
                overallCompletion
            };
        }

        // Create individual phase element
        function createPhaseElement(phase, index) {
            const phaseDiv = document.createElement('div');
            phaseDiv.className = 'research-phase';

            const phaseHeader = document.createElement('div');
            phaseHeader.className = 'phase-header';

            const phaseIcon = document.createElement('div');
            phaseIcon.className = 'phase-icon';
            phaseIcon.textContent = phase.icon;

            const phaseInfo = document.createElement('div');
            phaseInfo.className = 'phase-info';

            const phaseName = document.createElement('div');
            phaseName.className = 'phase-name';
            phaseName.textContent = phase.name;

            const phaseDesc = document.createElement('div');
            phaseDesc.className = 'phase-description';
            phaseDesc.textContent = phase.description;

            phaseInfo.appendChild(phaseName);
            phaseInfo.appendChild(phaseDesc);

            const phaseProgress = document.createElement('div');
            phaseProgress.className = 'phase-progress';

            const progressPercent = document.createElement('div');
            progressPercent.className = 'progress-percent';
            progressPercent.textContent = `${phase.completion}%`;

            const progressIndicator = document.createElement('div');
            progressIndicator.className = 'progress-indicator';
            progressIndicator.classList.add(phase.isComplete ? 'complete' : 'incomplete');

            phaseProgress.appendChild(progressPercent);
            phaseProgress.appendChild(progressIndicator);

            phaseHeader.appendChild(phaseIcon);
            phaseHeader.appendChild(phaseInfo);
            phaseHeader.appendChild(phaseProgress);

            phaseDiv.appendChild(phaseHeader);

            return phaseDiv;
        }

        // Update Next Actions priority panel for ABM workflows
        function updateNextActions() {
            const nextActionsContainer = document.getElementById('next-actions-container');
            if (!nextActionsContainer) return;

            const contacts = dashboardData.contacts || [];
            const triggerEvents = dashboardData.trigger_events || [];
            const primaryAccount = dashboardData.primary_account || {};

            // Clear existing content
            nextActionsContainer.innerHTML = '';

            // Create Next Actions panel
            const nextActionsPanel = document.createElement('div');
            nextActionsPanel.className = 'next-actions-panel';

            const title = document.createElement('h3');
            title.className = 'next-actions-title';
            title.textContent = 'Next Actions';
            title.style.color = 'var(--verdigris-primary)';
            title.style.marginBottom = '20px';
            nextActionsPanel.appendChild(title);

            // Generate priority actions
            const actions = generatePriorityActions(contacts, triggerEvents, primaryAccount);

            if (actions.length === 0) {
                const noActions = document.createElement('div');
                noActions.className = 'no-actions-message';
                noActions.textContent = 'No immediate actions required. Great work!';
                noActions.style.color = 'var(--verdigris-text-secondary)';
                noActions.style.fontStyle = 'italic';
                noActions.style.padding = '20px';
                noActions.style.textAlign = 'center';
                nextActionsPanel.appendChild(noActions);
                nextActionsContainer.appendChild(nextActionsPanel);
                return;
            }

            // Group actions by category
            const actionCategories = {
                urgent: actions.filter(a => a.priority === 'urgent'),
                high: actions.filter(a => a.priority === 'high'),
                medium: actions.filter(a => a.priority === 'medium'),
                low: actions.filter(a => a.priority === 'low')
            };

            // Create action sections
            Object.entries(actionCategories).forEach(([priority, categoryActions]) => {
                if (categoryActions.length === 0) return;

                const categorySection = document.createElement('div');
                categorySection.className = 'action-category';

                const categoryTitle = document.createElement('div');
                categoryTitle.className = `category-title priority-${priority}`;
                categoryTitle.textContent = `${priority.charAt(0).toUpperCase() + priority.slice(1)} Priority (${categoryActions.length})`;
                categorySection.appendChild(categoryTitle);

                const actionsList = document.createElement('div');
                actionsList.className = 'actions-list';

                categoryActions.forEach(action => {
                    const actionItem = document.createElement('div');
                    actionItem.className = `action-item priority-${priority}`;

                    const actionHeader = document.createElement('div');
                    actionHeader.className = 'action-header';

                    const actionTitle = document.createElement('div');
                    actionTitle.className = 'action-title';
                    actionTitle.textContent = action.title;

                    const actionBadge = document.createElement('span');
                    actionBadge.className = `action-badge priority-${priority}`;
                    actionBadge.textContent = action.type.toUpperCase();

                    actionHeader.appendChild(actionTitle);
                    actionHeader.appendChild(actionBadge);

                    const actionDescription = document.createElement('div');
                    actionDescription.className = 'action-description';
                    actionDescription.textContent = action.description;

                    const actionMeta = document.createElement('div');
                    actionMeta.className = 'action-meta';

                    if (action.contact) {
                        actionMeta.textContent = `Contact: ${action.contact}`;
                    } else if (action.account) {
                        actionMeta.textContent = `Account: ${action.account}`;
                    }

                    actionItem.appendChild(actionHeader);
                    actionItem.appendChild(actionDescription);
                    if (actionMeta.textContent) {
                        actionItem.appendChild(actionMeta);
                    }

                    actionsList.appendChild(actionItem);
                });

                categorySection.appendChild(actionsList);
                nextActionsPanel.appendChild(categorySection);
            });

            nextActionsContainer.appendChild(nextActionsPanel);
        }

        // Generate priority actions based on ABM data analysis
        function generatePriorityActions(contacts, triggerEvents, account) {
            const actions = [];

            // Priority 1: Urgent trigger events requiring immediate response
            const urgentSignals = triggerEvents.filter(e =>
                e.urgency_level === 'High' && e.confidence_score > 70
            );
            urgentSignals.forEach(signal => {
                actions.push({
                    type: 'trigger_response',
                    priority: 'urgent',
                    title: 'Respond to urgent buying signal',
                    description: signal.event_description?.substring(0, 100) + '...',
                    account: signal.company_name,
                    timeframe: '< 24 hours'
                });
            });

            // Priority 2: High-value MEDDIC contacts requiring immediate outreach
            const champions = contacts.filter(c =>
                c.meddic_role === 'Champion' &&
                (!c.last_contact_date || isStaleContact(c.last_contact_date))
            );
            champions.forEach(contact => {
                actions.push({
                    type: 'champion_outreach',
                    priority: 'urgent',
                    title: 'Connect with identified Champion',
                    description: `${contact.title} role shows strong Verdigris alignment. Immediate outreach recommended.`,
                    contact: contact.full_name,
                    timeframe: '< 48 hours'
                });
            });

            // Priority 3: Economic Buyers without recent engagement
            const economicBuyers = contacts.filter(c =>
                c.meddic_role === 'Economic Buyer' &&
                c.final_lead_score > 75
            );
            economicBuyers.forEach(contact => {
                actions.push({
                    type: 'executive_outreach',
                    priority: 'high',
                    title: 'Schedule Economic Buyer meeting',
                    description: `High-scoring executive (${contact.final_lead_score}/100) with budget authority. Strategic engagement required.`,
                    contact: contact.full_name,
                    timeframe: '< 1 week'
                });
            });

            // Priority 4: High LinkedIn activity contacts
            const activeContacts = contacts.filter(c =>
                c.linkedin_activity_score > 70 &&
                c.final_lead_score > 65
            );
            activeContacts.forEach(contact => {
                actions.push({
                    type: 'social_engagement',
                    priority: 'high',
                    title: 'Engage with active LinkedIn contact',
                    description: `High activity score (${contact.linkedin_activity_score}/100). Timing optimal for social selling approach.`,
                    contact: contact.full_name,
                    timeframe: '< 3 days'
                });
            });

            // Priority 5: Account health checks for low ICP fit
            if (account.icp_fit_score < 60) {
                actions.push({
                    type: 'account_validation',
                    priority: 'medium',
                    title: 'Validate ICP fit assumptions',
                    description: `Low ICP score (${account.icp_fit_score || 0}/100). Research may need refinement or account deprioritization.`,
                    account: account.name,
                    timeframe: '< 1 week'
                });
            }

            // Priority 6: Medium urgency trigger events
            const mediumSignals = triggerEvents.filter(e =>
                e.urgency_level === 'Medium' && e.confidence_score > 60
            );
            mediumSignals.slice(0, 3).forEach(signal => { // Limit to top 3
                actions.push({
                    type: 'signal_research',
                    priority: 'medium',
                    title: 'Research buying signal opportunity',
                    description: signal.event_description?.substring(0, 100) + '...',
                    account: signal.company_name,
                    timeframe: '< 5 days'
                });
            });

            // Priority 7: Follow-up with decision influencers
            const influencers = contacts.filter(c =>
                c.decision_influence === 'High' &&
                c.final_lead_score > 60 &&
                c.meddic_role !== 'Champion' &&
                c.meddic_role !== 'Economic Buyer'
            );
            influencers.forEach(contact => {
                actions.push({
                    type: 'influencer_nurture',
                    priority: 'medium',
                    title: 'Nurture decision influencer relationship',
                    description: `High influence (${contact.decision_influence}) in buying committee. Strategic relationship building opportunity.`,
                    contact: contact.full_name,
                    timeframe: '< 1 week'
                });
            });

            // Priority 8: Research gaps - missing key roles
            if (contacts.length > 0) {
                const hasChampion = contacts.some(c => c.meddic_role === 'Champion');
                const hasEconomicBuyer = contacts.some(c => c.meddic_role === 'Economic Buyer');
                const hasTechnicalBuyer = contacts.some(c => c.meddic_role === 'Technical Buyer');

                if (!hasChampion) {
                    actions.push({
                        type: 'research_gap',
                        priority: 'low',
                        title: 'Identify Champion in buying committee',
                        description: 'No Champion identified. Research needed to find internal advocate for Verdigris solution.',
                        account: account.name,
                        timeframe: '< 2 weeks'
                    });
                }

                if (!hasEconomicBuyer) {
                    actions.push({
                        type: 'research_gap',
                        priority: 'medium',
                        title: 'Map Economic Buyer for budget decisions',
                        description: 'Budget authority unclear. Executive mapping required for deal progression.',
                        account: account.name,
                        timeframe: '< 1 week'
                    });
                }
            }

            // Sort by priority and limit to top 8 actions
            const priorityOrder = { urgent: 1, high: 2, medium: 3, low: 4 };
            return actions
                .sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority])
                .slice(0, 8);
        }

        // Helper function to check if contact is stale
        function isStaleContact(lastContactDate) {
            if (!lastContactDate) return true;
            const daysSince = (Date.now() - new Date(lastContactDate).getTime()) / (1000 * 60 * 60 * 24);
            return daysSince > 14; // Consider stale if no contact for 2+ weeks
        }

        // Update contacts panel
        function updateContactsPanel() {
            const container = document.getElementById('contacts-container');
            const contacts = dashboardData.contacts || [];

            // Clear container
            container.innerHTML = '';

            if (contacts.length === 0) {
                container.appendChild(createEmptyState('üë•', 'No contacts found'));
                return;
            }

            // Sort contacts by lead score
            const sortedContacts = [...contacts].sort((a, b) =>
                (b.final_lead_score || b.lead_score || 0) - (a.final_lead_score || a.lead_score || 0)
            );

            // Display top priority contacts (score >= 70)
            const priorityContacts = sortedContacts.filter(contact =>
                (contact.final_lead_score || contact.lead_score || 0) >= 70
            );

            if (priorityContacts.length === 0) {
                container.appendChild(createEmptyState('üéØ', 'No priority contacts (score ‚â• 70) found'));
                return;
            }

            priorityContacts.slice(0, 10).forEach(contact => {
                container.appendChild(createContactCard(contact));
            });
        }

        // Create account card element - ABM account-centric view
        function createAccountCard(account) {
            const card = document.createElement('div');
            card.className = 'contact-card'; // Reuse contact card styling

            // Header section
            const header = document.createElement('div');
            header.className = 'contact-header';

            // Basic account info
            const basic = document.createElement('div');
            basic.className = 'contact-basic';

            const name = document.createElement('div');
            name.className = 'contact-name';
            name.textContent = account.name || 'Unknown Company';

            const domain = document.createElement('div');
            domain.className = 'contact-title';
            domain.textContent = account.domain || 'No domain';

            // Account actions (Website, Research)
            const actions = document.createElement('div');
            actions.className = 'contact-channels';

            if (account.domain) {
                const websiteBtn = document.createElement('a');
                websiteBtn.className = 'channel-btn';
                websiteBtn.href = account.domain.startsWith('http') ? account.domain : `https://${account.domain}`;
                websiteBtn.target = '_blank';
                websiteBtn.textContent = 'üåê Website';
                actions.appendChild(websiteBtn);
            }

            const researchBtn = document.createElement('button');
            researchBtn.className = 'channel-btn';
            researchBtn.textContent = 'üîç Research';
            researchBtn.onclick = () => {
                console.log(`Starting research for ${account.name}`);
                // Navigate to research view for this account
                showResearchView();
            };
            actions.appendChild(researchBtn);

            const accountPlanBtn = document.createElement('button');
            accountPlanBtn.className = 'channel-btn';
            accountPlanBtn.style.background = 'var(--verdigris-primary)';
            accountPlanBtn.style.color = 'var(--verdigris-dark)';
            accountPlanBtn.style.fontWeight = '600';
            accountPlanBtn.textContent = 'üéØ Account Plan';
            accountPlanBtn.onclick = () => {
                console.log(`Opening account plan for ${account.name}`);
                openAccountModal(account);
            };
            actions.appendChild(accountPlanBtn);

            basic.appendChild(name);
            basic.appendChild(domain);
            basic.appendChild(actions);

            // ICP Fit scoring section
            const scoreSection = document.createElement('div');
            scoreSection.className = 'lead-score';

            const mainScore = document.createElement('div');
            mainScore.className = 'score-main';
            mainScore.textContent = Math.round(account.icp_fit_score || 0);

            const breakdown = document.createElement('div');
            breakdown.className = 'score-breakdown';

            // Account-specific scoring breakdown
            const icpFitLine = document.createElement('div');
            icpFitLine.textContent = `ICP Fit: ${Math.round(account.icp_fit_score || 0)}%`;

            const sizeLine = document.createElement('div');
            sizeLine.textContent = `Size: ${account.company_size || 'Unknown'}`;

            const industryLine = document.createElement('div');
            industryLine.textContent = `Industry: ${account.industry || 'Unknown'}`;

            breakdown.appendChild(icpFitLine);
            breakdown.appendChild(sizeLine);
            breakdown.appendChild(industryLine);

            scoreSection.appendChild(mainScore);
            scoreSection.appendChild(breakdown);

            header.appendChild(basic);
            header.appendChild(scoreSection);
            card.appendChild(header);

            // Research status section
            if (account.research_completed || account.research_status) {
                const statusSection = document.createElement('div');
                statusSection.className = 'ai-recommendations';

                const statusTitle = document.createElement('div');
                statusTitle.className = 'recommendation-title';
                statusTitle.textContent = 'Research Status:';

                const statusContent = document.createElement('div');
                statusContent.className = 'recommendation-list';
                statusContent.textContent = account.research_completed
                    ? '‚úÖ Research Complete'
                    : account.research_status || '‚è≥ Pending Research';

                statusSection.appendChild(statusTitle);
                statusSection.appendChild(statusContent);
                card.appendChild(statusSection);
            }

            return card;
        }

        // Create contact card element
        function createContactCard(contact) {
            const card = document.createElement('div');
            card.className = 'contact-card';

            // Header
            const header = document.createElement('div');
            header.className = 'contact-header';

            // Basic info
            const basic = document.createElement('div');
            basic.className = 'contact-basic';

            const name = document.createElement('div');
            name.className = 'contact-name';
            name.textContent = contact.name || 'Unknown Contact';

            const title = document.createElement('div');
            title.className = 'contact-title';
            title.textContent = contact.title || 'Unknown Title';

            // Contact channels
            const channels = document.createElement('div');
            channels.className = 'contact-channels';

            if (contact.email) {
                const emailBtn = document.createElement('a');
                emailBtn.className = 'channel-btn';
                emailBtn.href = `mailto:${contact.email}`;
                emailBtn.textContent = 'üìß Email';
                channels.appendChild(emailBtn);
            }

            if (contact.linkedin_url) {
                const linkedinBtn = document.createElement('a');
                linkedinBtn.className = 'channel-btn';
                linkedinBtn.href = contact.linkedin_url;
                linkedinBtn.target = '_blank';
                linkedinBtn.textContent = 'üíº LinkedIn';
                channels.appendChild(linkedinBtn);
            }

            if (contact.phone) {
                const phoneBtn = document.createElement('a');
                phoneBtn.className = 'channel-btn';
                phoneBtn.href = `tel:${contact.phone}`;
                phoneBtn.textContent = 'üì± Call';
                channels.appendChild(phoneBtn);
            }

            basic.appendChild(name);
            basic.appendChild(title);
            basic.appendChild(channels);

            // Lead scoring
            const scoreSection = document.createElement('div');
            scoreSection.className = 'lead-score';

            const mainScore = document.createElement('div');
            mainScore.className = 'score-main';
            const finalScore = contact.final_lead_score || contact.lead_score || 0;
            mainScore.textContent = Math.round(finalScore);

            const breakdown = document.createElement('div');
            breakdown.className = 'score-breakdown';

            // Show transparent scoring dimensions per Feature Reference requirements
            if (contact.scoring_breakdown) {
                const sb = contact.scoring_breakdown;
                // Create secure scoring breakdown using DOM manipulation
                const icpFitLine = document.createElement('div');
                icpFitLine.textContent = `ICP Fit: ${Math.round(sb.icp_fit_score || 0)}`;

                const buyingPowerLine = document.createElement('div');
                buyingPowerLine.textContent = `Buying Power: ${Math.round(sb.buying_power_score || 0)}`;

                const engagementLine = document.createElement('div');
                engagementLine.textContent = `Engagement: ${Math.round(sb.engagement_score || 0)}`;

                breakdown.appendChild(icpFitLine);
                breakdown.appendChild(buyingPowerLine);
                breakdown.appendChild(engagementLine);
            } else if (contact.icp_fit_score !== undefined) {
                // Create secure scoring breakdown using DOM manipulation
                const icpFitLine = document.createElement('div');
                icpFitLine.textContent = `ICP Fit: ${Math.round(contact.icp_fit_score || 0)}`;

                const buyingPowerLine = document.createElement('div');
                buyingPowerLine.textContent = `Buying Power: ${Math.round(contact.buying_power_score || 0)}`;

                const engagementLine = document.createElement('div');
                engagementLine.textContent = `Engagement: ${Math.round(contact.engagement_potential_score || 0)}`;

                breakdown.appendChild(icpFitLine);
                breakdown.appendChild(buyingPowerLine);
                breakdown.appendChild(engagementLine);
            } else {
                breakdown.textContent = 'Score breakdown not available';
            }

            scoreSection.appendChild(mainScore);
            scoreSection.appendChild(breakdown);

            header.appendChild(basic);
            header.appendChild(scoreSection);
            card.appendChild(header);

            // MEDDIC Buying Committee Data
            if (contact.meddic_role || contact.decision_influence || contact.buying_committee_position) {
                const meddicSection = document.createElement('div');
                meddicSection.className = 'meddic-section';

                const meddicTitle = document.createElement('div');
                meddicTitle.className = 'meddic-title';
                meddicTitle.textContent = 'MEDDIC Profile';

                const meddicData = document.createElement('div');
                meddicData.className = 'meddic-data';

                // MEDDIC Role (Champion, Economic Buyer, Decision Maker, etc.)
                if (contact.meddic_role) {
                    const roleItem = document.createElement('div');
                    roleItem.className = 'meddic-item';

                    const roleLabel = document.createElement('span');
                    roleLabel.className = 'meddic-label';
                    roleLabel.textContent = 'Role:';

                    const roleValue = document.createElement('span');
                    roleValue.className = 'meddic-value meddic-role';
                    roleValue.textContent = contact.meddic_role;

                    roleItem.appendChild(roleLabel);
                    roleItem.appendChild(roleValue);
                    meddicData.appendChild(roleItem);
                }

                // Decision Influence Level
                if (contact.decision_influence) {
                    const influenceItem = document.createElement('div');
                    influenceItem.className = 'meddic-item';

                    const influenceLabel = document.createElement('span');
                    influenceLabel.className = 'meddic-label';
                    influenceLabel.textContent = 'Influence:';

                    const influenceValue = document.createElement('span');
                    influenceValue.className = 'meddic-value meddic-influence';
                    influenceValue.textContent = contact.decision_influence;

                    influenceItem.appendChild(influenceLabel);
                    influenceItem.appendChild(influenceValue);
                    meddicData.appendChild(influenceItem);
                }

                // Buying Committee Position
                if (contact.buying_committee_position) {
                    const positionItem = document.createElement('div');
                    positionItem.className = 'meddic-item';

                    const positionLabel = document.createElement('span');
                    positionLabel.className = 'meddic-label';
                    positionLabel.textContent = 'Committee:';

                    const positionValue = document.createElement('span');
                    positionValue.className = 'meddic-value meddic-position';
                    positionValue.textContent = contact.buying_committee_position;

                    positionItem.appendChild(positionLabel);
                    positionItem.appendChild(positionValue);
                    meddicData.appendChild(positionItem);
                }

                // Pain Points (if available)
                if (contact.pain_points) {
                    const painItem = document.createElement('div');
                    painItem.className = 'meddic-item meddic-pain';

                    const painLabel = document.createElement('span');
                    painLabel.className = 'meddic-label';
                    painLabel.textContent = 'Pain Points:';

                    const painValue = document.createElement('span');
                    painValue.className = 'meddic-value';
                    painValue.textContent = Array.isArray(contact.pain_points)
                        ? contact.pain_points.join(', ')
                        : contact.pain_points;

                    painItem.appendChild(painLabel);
                    painItem.appendChild(painValue);
                    meddicData.appendChild(painItem);
                }

                // Budget Authority
                if (contact.budget_authority) {
                    const budgetItem = document.createElement('div');
                    budgetItem.className = 'meddic-item';

                    const budgetLabel = document.createElement('span');
                    budgetLabel.className = 'meddic-label';
                    budgetLabel.textContent = 'Budget:';

                    const budgetValue = document.createElement('span');
                    budgetValue.className = 'meddic-value meddic-budget';
                    budgetValue.textContent = contact.budget_authority;

                    budgetItem.appendChild(budgetLabel);
                    budgetItem.appendChild(budgetValue);
                    meddicData.appendChild(budgetItem);
                }

                meddicSection.appendChild(meddicTitle);
                meddicSection.appendChild(meddicData);
                card.appendChild(meddicSection);
            }

            // AI Recommendations per Feature Reference requirements
            if (contact.problems_owned || contact.value_add_ideas || contact.connection_pathways) {
                const aiSection = document.createElement('div');
                aiSection.className = 'ai-recommendations';

                if (contact.problems_owned) {
                    const problemsSection = document.createElement('div');
                    problemsSection.className = 'recommendation-section';

                    const problemsTitle = document.createElement('div');
                    problemsTitle.className = 'recommendation-title';
                    problemsTitle.textContent = 'Problems They Own:';

                    const problemsList = document.createElement('div');
                    problemsList.className = 'recommendation-list';
                    problemsList.textContent = Array.isArray(contact.problems_owned)
                        ? contact.problems_owned.join(', ')
                        : contact.problems_owned;

                    problemsSection.appendChild(problemsTitle);
                    problemsSection.appendChild(problemsList);
                    aiSection.appendChild(problemsSection);
                }

                if (contact.value_add_ideas) {
                    const ideasSection = document.createElement('div');
                    ideasSection.className = 'recommendation-section';

                    const ideasTitle = document.createElement('div');
                    ideasTitle.className = 'recommendation-title';
                    ideasTitle.textContent = 'Value-Add Ideas:';

                    const ideasList = document.createElement('div');
                    ideasList.className = 'recommendation-list';
                    ideasList.textContent = Array.isArray(contact.value_add_ideas)
                        ? contact.value_add_ideas.join(', ')
                        : contact.value_add_ideas;

                    ideasSection.appendChild(ideasTitle);
                    ideasSection.appendChild(ideasList);
                    aiSection.appendChild(ideasSection);
                }

                if (contact.connection_pathways) {
                    const pathwaysSection = document.createElement('div');
                    pathwaysSection.className = 'recommendation-section';

                    const pathwaysTitle = document.createElement('div');
                    pathwaysTitle.className = 'recommendation-title';
                    pathwaysTitle.textContent = 'Connection Pathways:';

                    const pathwaysList = document.createElement('div');
                    pathwaysList.className = 'recommendation-list';
                    pathwaysList.textContent = contact.connection_pathways;

                    pathwaysSection.appendChild(pathwaysTitle);
                    pathwaysSection.appendChild(pathwaysList);
                    aiSection.appendChild(pathwaysSection);
                }

                card.appendChild(aiSection);
            }

            return card;
        }

        // Update signals panel
        function updateSignalsPanel() {
            const container = document.getElementById('signals-container');
            const events = dashboardData.trigger_events || [];

            container.innerHTML = '';

            if (events.length === 0) {
                container.appendChild(createEmptyState('üìà', 'No trigger events found'));
                return;
            }

            // Sort by urgency and relevance
            const sortedEvents = [...events].sort((a, b) => {
                const urgencyOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                const aUrgency = urgencyOrder[a.urgency_level] || 0;
                const bUrgency = urgencyOrder[b.urgency_level] || 0;

                if (aUrgency !== bUrgency) {
                    return bUrgency - aUrgency;
                }

                return (b.relevance_score || 0) - (a.relevance_score || 0);
            });

            sortedEvents.slice(0, 8).forEach(event => {
                container.appendChild(createTriggerEventCard(event));
            });
        }

        // Create trigger event card element
        function createTriggerEventCard(event) {
            const card = document.createElement('div');
            card.className = 'trigger-event';

            // Event header
            const header = document.createElement('div');
            header.className = 'event-header';

            const title = document.createElement('div');
            title.className = 'event-title';
            title.textContent = event.description || 'Unknown Event';

            const meta = document.createElement('div');
            meta.className = 'event-meta';

            // Event type
            const type = document.createElement('span');
            type.className = 'event-type';
            type.textContent = event.event_type || 'Unknown';

            // Urgency level
            const urgency = document.createElement('span');
            urgency.className = `event-type urgency-${(event.urgency_level || 'low').toLowerCase()}`;
            urgency.textContent = event.urgency_level || 'Low';

            meta.appendChild(type);
            meta.appendChild(urgency);

            header.appendChild(title);
            header.appendChild(meta);
            card.appendChild(header);

            // Event scores per Feature Reference requirements
            const scores = document.createElement('div');
            scores.className = 'event-scores';

            const confidence = document.createElement('div');
            confidence.className = 'confidence-score';
            confidence.textContent = `${event.confidence_score || 0}% Confidence`;

            const relevance = document.createElement('div');
            relevance.className = 'relevance-score';
            relevance.textContent = `${event.relevance_score || 0}% Relevance`;

            scores.appendChild(confidence);
            scores.appendChild(relevance);
            card.appendChild(scores);

            // Source URL per Feature Reference requirements
            if (event.source_url) {
                const sourceLink = document.createElement('a');
                sourceLink.className = 'source-link';
                sourceLink.href = event.source_url;
                sourceLink.target = '_blank';
                sourceLink.textContent = 'üîó View Source';

                const metadata = document.createElement('div');
                metadata.appendChild(sourceLink);
                card.appendChild(metadata);
            }

            return card;
        }

        // Update partnerships panel
        function updatePartnershipsPanel() {
            const container = document.getElementById('partnerships-container');
            const partnerships = dashboardData.partnerships || [];

            container.innerHTML = '';

            if (partnerships.length === 0) {
                container.appendChild(createEmptyState('ü§ù', 'No strategic partnerships detected'));
                return;
            }

            partnerships.slice(0, 8).forEach(partnership => {
                container.appendChild(createPartnershipCard(partnership));
            });
        }

        // Create partnership card element (DOM-based)
        function createPartnershipCard(partnership) {
            const card = document.createElement('div');
            card.className = 'partnership-card';

            // Partnership header
            const header = document.createElement('div');
            header.className = 'partnership-header';

            const name = document.createElement('div');
            name.className = 'partner-name';
            name.textContent = partnership.partner_name || 'Unknown Partner';

            const category = document.createElement('span');
            category.className = 'partner-category';
            category.textContent = partnership.category || 'Unknown Category';

            header.appendChild(name);
            header.appendChild(category);
            card.appendChild(header);

            // Opportunity description
            if (partnership.verdigris_opportunity_angle) {
                const opportunity = document.createElement('div');
                opportunity.className = 'opportunity-text';
                opportunity.textContent = partnership.verdigris_opportunity_angle;
                card.appendChild(opportunity);
            }

            // Evidence URL
            if (partnership.evidence_url) {
                const evidenceLink = document.createElement('a');
                evidenceLink.className = 'source-link';
                evidenceLink.href = partnership.evidence_url;
                evidenceLink.target = '_blank';
                evidenceLink.textContent = 'üîó View Evidence';
                card.appendChild(evidenceLink);
            }

            return card;
        }

        // Create partnership card HTML (string-based for innerHTML)
        function createPartnershipCardHTML(partnership) {
            const partnerName = partnership.partner_name || 'Unknown Partner';
            const category = partnership.category || 'Unknown Category';
            const relevance = partnership.verdigris_relevance || 'Medium';
            const opportunity = partnership.verdigris_opportunity_angle || '';
            const evidenceUrl = partnership.evidence_url || '';

            const relevanceClass = relevance.toLowerCase() === 'high' ? 'high-relevance' :
                                   relevance.toLowerCase() === 'low' ? 'low-relevance' : 'medium-relevance';

            return `
                <div class="partnership-card ${relevanceClass}">
                    <div class="partnership-header">
                        <div class="partner-name">${partnerName}</div>
                        <span class="partner-category">${category}</span>
                    </div>
                    <div class="partner-relevance">
                        <span class="relevance-badge">${relevance} Relevance</span>
                    </div>
                    ${opportunity ? `<div class="opportunity-text">${opportunity}</div>` : ''}
                    ${evidenceUrl ? `<a class="source-link" href="${evidenceUrl}" target="_blank">üîó View Evidence</a>` : ''}
                </div>
            `;
        }

        // Calculate partnership analytics and insights
        function calculatePartnershipAnalytics(partnerships) {
            if (!partnerships || partnerships.length === 0) {
                return {
                    topTechnology: 'None',
                    highValueCount: 0,
                    mostMentionedPartner: 'None',
                    technologyBreakdown: [],
                    topServices: ['No data available'],
                    coSellScore: 0,
                    partnershipPattern: 'Insufficient partnership data for analysis'
                };
            }

            // Technology analysis
            const techMap = {};
            partnerships.forEach(p => {
                const tech = p.partnership_type || p.category || 'Unknown';
                techMap[tech] = (techMap[tech] || 0) + 1;
            });

            const technologyBreakdown = Object.entries(techMap)
                .map(([name, count]) => ({ name, count }))
                .sort((a, b) => b.count - a.count);

            const topTechnology = technologyBreakdown[0]?.name || 'Unknown';

            // High-value partner count (those with High relevance)
            const highValueCount = partnerships.filter(p =>
                p.verdigris_relevance === 'High'
            ).length;

            // Most mentioned partner analysis
            const partnerMentions = {};
            partnerships.forEach(p => {
                const name = p.partner_name || 'Unknown';
                partnerMentions[name] = (partnerMentions[name] || 0) + 1;
            });
            const mostMentionedPartner = Object.entries(partnerMentions)
                .sort(([,a], [,b]) => b - a)[0]?.[0] || 'None';

            // Extract services from descriptions and opportunity angles
            const services = [];
            partnerships.forEach(p => {
                const text = `${p.verdigris_opportunity_angle || ''} ${p.partnership_type || ''}`.toLowerCase();
                if (text.includes('ai') || text.includes('artificial intelligence')) services.push('AI');
                if (text.includes('cloud') || text.includes('infrastructure')) services.push('Cloud Infrastructure');
                if (text.includes('analytics') || text.includes('data')) services.push('Data Analytics');
                if (text.includes('security') || text.includes('cybersecurity')) services.push('Security');
                if (text.includes('automation') || text.includes('workflow')) services.push('Automation');
                if (text.includes('integration') || text.includes('api')) services.push('Integration');
            });

            const serviceCount = {};
            services.forEach(s => serviceCount[s] = (serviceCount[s] || 0) + 1);
            const topServices = Object.entries(serviceCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .map(([service]) => service);

            if (topServices.length === 0) {
                topServices.push('Platform Services', 'Technology Solutions', 'Business Integration');
            }

            // Calculate co-sell score based on various factors
            const coSellScore = Math.min(100, Math.round(
                (partnerships.length * 10) +
                (highValueCount * 15) +
                (technologyBreakdown.length * 5) +
                (topServices.length * 8)
            ));

            // Determine partnership pattern
            let partnershipPattern = 'Diverse ecosystem approach';
            if (highValueCount > partnerships.length * 0.6) {
                partnershipPattern = 'High-value strategic focus';
            } else if (technologyBreakdown[0]?.count > partnerships.length * 0.5) {
                partnershipPattern = `${topTechnology} specialization strategy`;
            } else if (partnerships.length > 10) {
                partnershipPattern = 'Broad partnership network';
            }

            return {
                topTechnology,
                highValueCount,
                mostMentionedPartner,
                technologyBreakdown: technologyBreakdown.slice(0, 5), // Top 5
                topServices,
                coSellScore,
                partnershipPattern
            };
        }

        // Create empty state element
        function createEmptyState(icon, message) {
            const emptyState = document.createElement('div');
            emptyState.className = 'empty-state';

            const iconEl = document.createElement('div');
            iconEl.className = 'empty-state-icon';
            iconEl.textContent = icon;

            const messageEl = document.createElement('div');
            messageEl.textContent = message;

            emptyState.appendChild(iconEl);
            emptyState.appendChild(messageEl);

            return emptyState;
        }

        // Setup research form
        function setupResearchForm() {
            const form = document.getElementById('research-form');
            form.addEventListener('submit', handleResearchSubmit);
        }

        // Handle research form submission
        async function handleResearchSubmit(event) {
            event.preventDefault();

            const companyName = document.getElementById('company-name').value.trim();
            const companyDomain = document.getElementById('company-domain').value.trim();

            if (!companyName || !companyDomain) {
                showError('Please provide both company name and domain');
                return;
            }

            try {
                console.log(`üî¨ Starting research for ${companyName} (${companyDomain})`);

                const response = await fetch('/api/research/start', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        company_name: companyName,
                        company_domain: companyDomain
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('‚úÖ Research started:', result);

                activeResearchJob = result.job_id;
                showProgressContainer();
                startProgressTracking();

                // Clear form
                document.getElementById('company-name').value = '';
                document.getElementById('company-domain').value = '';

            } catch (error) {
                console.error('‚ùå Error starting research:', error);
                showError('Failed to start research: ' + error.message);
            }
        }

        // Show progress container
        function showProgressContainer() {
            const container = document.getElementById('progress-container');
            container.style.display = 'block';

            // Reset all steps
            const steps = document.querySelectorAll('.progress-step');
            steps.forEach(step => {
                step.classList.remove('active', 'completed');
            });
        }

        // Start progress tracking
        function startProgressTracking() {
            let currentPhase = 1;

            const updateProgress = () => {
                if (currentPhase <= 5) {
                    const currentStep = document.querySelector(`[data-phase="${currentPhase}"]`);
                    const previousStep = document.querySelector(`[data-phase="${currentPhase - 1}"]`);

                    if (previousStep) {
                        previousStep.classList.remove('active');
                        previousStep.classList.add('completed');
                    }

                    if (currentStep) {
                        currentStep.classList.add('active');
                    }

                    currentPhase++;

                    if (currentPhase <= 5) {
                        setTimeout(updateProgress, 5000); // Simulate 5 seconds per phase
                    } else {
                        // Complete final phase
                        const finalStep = document.querySelector(`[data-phase="5"]`);
                        if (finalStep) {
                            finalStep.classList.remove('active');
                            finalStep.classList.add('completed');
                        }

                        // Refresh dashboard after completion
                        setTimeout(() => {
                            loadDashboardData();
                            document.getElementById('progress-container').style.display = 'none';
                        }, 2000);
                    }
                }
            };

            updateProgress();
        }

        // Refresh dashboard
        async function refreshDashboard() {
            console.log('üîÑ Refreshing dashboard...');
            await loadDashboardData();
        }

        // Start auto-refresh
        function startAutoRefresh() {
            // Clear any existing interval to prevent duplicates
            if (refreshInterval) {
                console.log('üîÑ Clearing existing auto-refresh interval');
                clearInterval(refreshInterval);
            }
            console.log('üîÑ Starting auto-refresh interval');
            refreshInterval = setInterval(refreshDashboard, 60000); // Refresh every minute
        }

        // Update last updated timestamp
        function updateLastUpdated() {
            const timestamp = new Date().toLocaleTimeString();
            setTextContent('last-updated', `Last updated: ${timestamp}`);
        }

        // Show error message
        function showError(message) {
            console.error('‚ùå Dashboard Error:', message);

            // Create error element if it doesn't exist
            let errorEl = document.getElementById('dashboard-error');
            if (!errorEl) {
                errorEl = document.createElement('div');
                errorEl.id = 'dashboard-error';
                errorEl.className = 'error-message';

                const header = document.querySelector('.dashboard-header');
                header.insertAdjacentElement('afterend', errorEl);
            }

            errorEl.textContent = message;
            errorEl.style.display = 'block';

            // Auto-hide after 10 seconds
            setTimeout(() => {
                errorEl.style.display = 'none';
            }, 10000);
        }

        // Navigation functions
        async function showSection(section) {
            console.log(`üîÑ Switching to section: ${section}`);

            // Show loading state
            showLoadingState();

            try {
                switch (section) {
                    case 'dashboard':
                        // Default view - reload all data
                        await loadDashboardData();
                        break;
                    case 'accounts':
                        await showAccountsView();
                        break;
                    case 'contacts':
                        await showContactsView();
                        break;
                    case 'signals':
                        await showSignalsView();
                        break;
                    case 'partnerships':
                        await showPartnershipsView();
                        break;
                    case 'research':
                        showResearchView();
                        break;
                    default:
                        console.warn(`Unknown section: ${section}`);
                        await loadDashboardData();
                }
            } catch (error) {
                console.error(`Error loading section ${section}:`, error);
                showError(`Failed to load ${section} view`);
            }
        }

        async function showAccountsView() {
            const response = await fetch('/api/accounts');
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch accounts');
            }

            // Update main content area to show accounts
            updateMainContentForAccounts(data.accounts);
        }

        async function showContactsView() {
            const response = await fetch('/api/contacts');
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch contacts');
            }

            // Update main content area to show contacts
            updateMainContentForContacts(data.contacts);
        }

        async function showSignalsView() {
            const response = await fetch('/api/signals');
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch signals');
            }

            // Update main content area to show signals
            updateMainContentForSignals(data.signals);
        }

        async function showPartnershipsView() {
            const response = await fetch('/api/partnerships');
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.error || 'Failed to fetch partnerships');
            }

            // Update main content area to show partnerships
            updateMainContentForPartnerships(data.partnerships);
        }

        function showResearchView() {
            // Show research interface
            updateMainContentForResearch();
        }

        function updateMainContentForAccounts(accounts) {
            const mainContent = document.querySelector('.main-content');

            // Clear existing content
            mainContent.innerHTML = '';

            // Create header section with secure DOM manipulation
            const header = document.createElement('div');
            header.className = 'dashboard-header';

            const title = document.createElement('h1');
            title.className = 'header-title';
            title.textContent = 'Account Portfolio';

            const subtitle = document.createElement('p');
            subtitle.className = 'header-subtitle';
            subtitle.textContent = 'Target accounts and research status';

            header.appendChild(title);
            header.appendChild(subtitle);

            // Create stats section
            const statsContainer = document.createElement('div');
            statsContainer.className = 'dashboard-stats';

            // Total accounts stat
            const totalStat = document.createElement('div');
            totalStat.className = 'stat-card';
            const totalValue = document.createElement('div');
            totalValue.className = 'stat-value';
            totalValue.textContent = accounts.length;
            const totalLabel = document.createElement('div');
            totalLabel.className = 'stat-label';
            totalLabel.textContent = 'Total Accounts';
            totalStat.appendChild(totalValue);
            totalStat.appendChild(totalLabel);

            // High ICP fit stat
            const highFitAccounts = accounts.filter(a => (a.icp_fit_score || 0) >= 80);
            const highFitStat = document.createElement('div');
            highFitStat.className = 'stat-card';
            const highFitValue = document.createElement('div');
            highFitValue.className = 'stat-value';
            highFitValue.textContent = highFitAccounts.length;
            const highFitLabel = document.createElement('div');
            highFitLabel.className = 'stat-label';
            highFitLabel.textContent = 'High ICP Fit';
            highFitStat.appendChild(highFitValue);
            highFitStat.appendChild(highFitLabel);

            // Research completed stat
            const completedAccounts = accounts.filter(a => a.research_completed);
            const completedStat = document.createElement('div');
            completedStat.className = 'stat-card';
            const completedValue = document.createElement('div');
            completedValue.className = 'stat-value';
            completedValue.textContent = completedAccounts.length;
            const completedLabel = document.createElement('div');
            completedLabel.className = 'stat-label';
            completedLabel.textContent = 'Research Complete';
            completedStat.appendChild(completedValue);
            completedStat.appendChild(completedLabel);

            statsContainer.appendChild(totalStat);
            statsContainer.appendChild(highFitStat);
            statsContainer.appendChild(completedStat);

            // Create accounts section
            const accountsSection = document.createElement('div');
            accountsSection.className = 'accounts-section';

            accounts.forEach(account => {
                const accountCard = createAccountCard(account);
                accountsSection.appendChild(accountCard);
            });

            // Assemble the complete view
            mainContent.appendChild(header);
            mainContent.appendChild(statsContainer);
            mainContent.appendChild(accountsSection);
        }

        function updateMainContentForContacts(contacts) {
            const mainContent = document.querySelector('.main-content');

            let html = `
                <div class="dashboard-header">
                    <h1 class="header-title">Priority Contacts</h1>
                    <p class="header-subtitle">Key contacts across target accounts</p>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value">${contacts.length}</div>
                        <div class="stat-label">Total Contacts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${contacts.filter(c => c.final_lead_score >= 80).length}</div>
                        <div class="stat-label">High Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${contacts.filter(c => c.final_lead_score >= 70).length}</div>
                        <div class="stat-label">Priority</div>
                    </div>
                </div>
            `;

            html += '<div class="contacts-section">';
            contacts.forEach(contact => {
                html += createContactCard(contact);
            });
            html += '</div>';

            mainContent.innerHTML = html;
        }

        function updateMainContentForSignals(signals) {
            const mainContent = document.querySelector('.main-content');

            let html = `
                <div class="dashboard-header">
                    <h1 class="header-title">Buying Signals</h1>
                    <p class="header-subtitle">Trigger events and market opportunities</p>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value">${signals.length}</div>
                        <div class="stat-label">Total Signals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${signals.filter(s => s.urgency_level === 'High').length}</div>
                        <div class="stat-label">High Priority</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${signals.filter(s => s.urgency_level === 'Medium').length}</div>
                        <div class="stat-label">Medium Priority</div>
                    </div>
                </div>
            `;

            html += '<div class="trigger-events-section">';
            signals.forEach(signal => {
                html += createTriggerEventCard(signal);
            });
            html += '</div>';

            mainContent.innerHTML = html;
        }

        function updateMainContentForPartnerships(partnerships) {
            const mainContent = document.querySelector('.main-content');

            // Calculate partnership analytics
            const analytics = calculatePartnershipAnalytics(partnerships);

            const html = `
                <div class="dashboard-header">
                    <h1 class="header-title">Strategic Partnerships</h1>
                    <p class="header-subtitle">Partnership ecosystem intelligence with segmentation insights</p>
                </div>

                <!-- Partnership Analytics Dashboard -->
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-value">${partnerships.length}</div>
                        <div class="stat-label">Total Partners</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${analytics.topTechnology}</div>
                        <div class="stat-label">Top Technology</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${analytics.highValueCount}</div>
                        <div class="stat-label">High-Value Partners</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${analytics.mostMentionedPartner}</div>
                        <div class="stat-label">Most Active Partner</div>
                    </div>
                </div>

                <!-- Partnership Insights Section -->
                <div class="insights-section">
                    <div class="insights-panel">
                        <h3 class="insights-title">üîç Partnership Intelligence</h3>
                        <div class="insights-content">
                            <div class="insight-item">
                                <strong>Technology Segmentation:</strong>
                                ${analytics.technologyBreakdown.map(tech => `${tech.name} (${tech.count})`).join(', ')}
                            </div>
                            <div class="insight-item">
                                <strong>Prevalent Services:</strong>
                                ${analytics.topServices.join(', ')}
                            </div>
                            <div class="insight-item">
                                <strong>Co-sell Opportunity Score:</strong>
                                ${analytics.coSellScore}/100 based on partner ecosystem alignment
                            </div>
                            <div class="insight-item">
                                <strong>Key Partnership Pattern:</strong>
                                ${analytics.partnershipPattern}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="partnerships-container" id="partnerships-container">
                    <!-- Partnership cards will be populated here -->
                </div>
            `;

            mainContent.innerHTML = html;

            // Populate partnership cards using DOM manipulation (not string concatenation)
            const partnershipsContainer = document.getElementById('partnerships-container');
            partnerships.forEach(partnership => {
                const cardHtml = createPartnershipCardHTML(partnership);
                partnershipsContainer.innerHTML += cardHtml;
            });
        }

        function updateMainContentForResearch() {
            const mainContent = document.querySelector('.main-content');

            const html = `
                <div class="dashboard-header">
                    <h1 class="header-title">Account Research</h1>
                    <p class="header-subtitle">Start new ABM research campaigns</p>
                </div>

                <div class="research-panel">
                    <h2 class="panel-title">New Research Campaign</h2>
                    <div class="research-form">
                        <div class="form-group">
                            <label for="research-company">Company Name</label>
                            <input type="text" id="research-company" placeholder="Enter company name">
                        </div>
                        <div class="form-group">
                            <label for="research-domain">Domain</label>
                            <input type="text" id="research-domain" placeholder="company.com">
                        </div>
                        <button class="btn btn-primary" onclick="startResearch()">
                            üî¨ Start Research
                        </button>
                    </div>
                </div>

                <!-- Progress tracking -->
                <div id="progress-container" style="display: none;">
                    <div class="progress-panel">
                        <h3>Research Progress</h3>
                        <div class="progress-steps">
                            <div class="progress-step" data-phase="1">
                                <div class="step-icon">üîç</div>
                                <div class="step-text">Contact Discovery</div>
                            </div>
                            <div class="progress-step" data-phase="2">
                                <div class="step-icon">üíº</div>
                                <div class="step-text">LinkedIn Enrichment</div>
                            </div>
                            <div class="progress-step" data-phase="3">
                                <div class="step-icon">üìà</div>
                                <div class="step-text">Trigger Detection</div>
                            </div>
                            <div class="progress-step" data-phase="4">
                                <div class="step-icon">ü§ù</div>
                                <div class="step-text">Partnership Intel</div>
                            </div>
                            <div class="progress-step" data-phase="5">
                                <div class="step-icon">‚≠ê</div>
                                <div class="step-text">Lead Scoring</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            mainContent.innerHTML = html;
        }

        function showLoadingState() {
            const mainContent = document.querySelector('.main-content');
            mainContent.innerHTML = `
                <div class="dashboard-header">
                    <h1 class="header-title">Loading...</h1>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; height: 200px;">
                    <div style="font-size: 18px; color: var(--verdigris-text-secondary);">üîÑ Loading data...</div>
                </div>
            `;
        }

        // Utility function to safely set text content
        function setTextContent(elementId, content) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = content;
            }
        }

        // Company Research Functions
        function startCompanyResearch(event) {
            event.preventDefault();

            const companyName = document.getElementById('company-name').value.trim();
            const companyDomain = document.getElementById('company-domain').value.trim();

            if (!companyName || !companyDomain) {
                showError('Please enter both company name and domain');
                return;
            }

            // Show status and disable form
            const statusDiv = document.getElementById('research-status');
            const btn = document.getElementById('research-btn');
            const form = document.getElementById('research-form');

            statusDiv.classList.add('active');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Researching...';

            updateResearchProgress(0, 'Initiating Research', 'Verifying company information...');

            // Call the research API
            fetch('/api/research/start', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    company_name: companyName,
                    domain: companyDomain
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    throw new Error(data.error);
                }

                // Start monitoring research progress
                activeResearchJob = data.job_id;
                updateResearchProgress(10, 'Research Started', `Conducting comprehensive research for ${companyName}...`);
                monitorResearchProgress(data.job_id, companyName);
            })
            .catch(error => {
                console.error('Research error:', error);
                showError('Failed to start research: ' + error.message);
                resetResearchForm();
            });
        }

        function monitorResearchProgress(jobId, companyName) {
            const checkProgress = () => {
                fetch(`/api/research/status/${jobId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }

                    const progress = data.progress || 0;
                    let statusText = data.status || 'running';

                    // Update progress based on status
                    switch (statusText) {
                        case 'running':
                            updateResearchProgress(
                                Math.min(progress + 20, 90),
                                'Research In Progress',
                                `Analyzing ${companyName} - discovering contacts, signals, and partnerships...`
                            );
                            setTimeout(checkProgress, 2000);
                            break;
                        case 'completed':
                            updateResearchProgress(100, 'Research Complete!', `Successfully completed research for ${companyName}`);
                            setTimeout(() => {
                                resetResearchForm();
                                loadDashboardData(); // Refresh dashboard to show new data
                                showSuccess(`Research completed for ${companyName}! Check the dashboard for insights.`);
                            }, 2000);
                            break;
                        case 'error':
                            throw new Error(data.error || 'Research failed');
                        default:
                            setTimeout(checkProgress, 2000);
                    }
                })
                .catch(error => {
                    console.error('Progress check error:', error);
                    showError('Research monitoring error: ' + error.message);
                    resetResearchForm();
                });
            };

            setTimeout(checkProgress, 1000);
        }

        function updateResearchProgress(percentage, title, text) {
            const progressFill = document.getElementById('research-progress-fill');
            const statusTitle = document.getElementById('research-status-title');
            const statusText = document.getElementById('research-status-text');

            if (progressFill) progressFill.style.width = `${percentage}%`;
            if (statusTitle) statusTitle.textContent = title;
            if (statusText) statusText.textContent = text;
        }

        function resetResearchForm() {
            const statusDiv = document.getElementById('research-status');
            const btn = document.getElementById('research-btn');
            const form = document.getElementById('research-form');

            statusDiv.classList.remove('active');
            btn.disabled = false;
            btn.innerHTML = 'üöÄ Start Research';
            form.reset();
            activeResearchJob = null;
        }

        function showSuccess(message) {
            // Create success notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #00e5ff, #0099cc);
                color: #001122;
                padding: 16px 24px;
                border-radius: 8px;
                font-weight: 600;
                box-shadow: 0 8px 32px rgba(0, 229, 255, 0.3);
                z-index: 10000;
                max-width: 400px;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        function showError(message) {
            // Create error notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4444;
                color: white;
                padding: 16px 24px;
                border-radius: 8px;
                font-weight: 600;
                box-shadow: 0 8px 32px rgba(255, 68, 68, 0.3);
                z-index: 10000;
                max-width: 400px;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error:', event.error);
            showError('An unexpected error occurred. Please refresh the page.');
        });

        // Handle unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showError('An unexpected error occurred. Please refresh the page.');
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ACCOUNT PLAN MODAL FUNCTIONALITY
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Open account plan modal with comprehensive ABM data
        async function openAccountModal(account) {
            try {
                const modal = document.getElementById('account-plan-modal');
                const companyNameSpan = document.getElementById('account-modal-company-name');

                // Set account name in modal title
                companyNameSpan.textContent = account.name || 'Unknown Company';

                // Show modal
                modal.classList.add('active');

                // Set basic account overview
                updateAccountOverview(account);

                // Load comprehensive account data
                await loadAccountPlanData(account);

            } catch (error) {
                console.error('Error opening account modal:', error);
                showError('Failed to load account details');
            }
        }

        // Close account plan modal
        function closeAccountModal() {
            const modal = document.getElementById('account-plan-modal');
            modal.classList.remove('active');
        }

        // Update account overview section
        function updateAccountOverview(account) {
            const overviewContent = document.getElementById('account-overview-content');
            const icpScore = document.getElementById('account-icp-score');
            const researchStatus = document.getElementById('account-research-status');

            // Account overview details
            overviewContent.innerHTML = `
                <div style="display: grid; gap: 12px;">
                    <div>
                        <strong style="color: var(--verdigris-primary);">Domain:</strong>
                        <span style="color: var(--verdigris-text-secondary);">${account.domain || 'Unknown'}</span>
                    </div>
                    <div>
                        <strong style="color: var(--verdigris-primary);">Industry:</strong>
                        <span style="color: var(--verdigris-text-secondary);">${account.industry || 'Unknown'}</span>
                    </div>
                    <div>
                        <strong style="color: var(--verdigris-primary);">Company Size:</strong>
                        <span style="color: var(--verdigris-text-secondary);">${account.company_size || 'Unknown'}</span>
                    </div>
                    <div>
                        <strong style="color: var(--verdigris-primary);">Location:</strong>
                        <span style="color: var(--verdigris-text-secondary);">${account.location || 'Unknown'}</span>
                    </div>
                </div>
            `;

            // ICP Fit Score
            const fitScore = account.icp_fit_score || 0;
            icpScore.textContent = fitScore + '%';
            icpScore.style.color = fitScore >= 80 ? 'var(--verdigris-primary)' :
                                  fitScore >= 60 ? '#ffaa00' : '#888';

            // Research Status
            const completed = account.research_completed;
            researchStatus.textContent = completed ? '‚úÖ Done' : 'üîÑ Pending';
            researchStatus.style.color = completed ? 'var(--verdigris-primary)' : '#ffaa00';
        }

        // Load comprehensive account plan data from all sources
        async function loadAccountPlanData(account) {
            try {
                // Fetch all data sources in parallel
                const [contactsResponse, signalsResponse, partnershipsResponse] = await Promise.all([
                    fetch('/api/contacts'),
                    fetch('/api/signals'),
                    fetch('/api/partnerships')
                ]);

                const contactsData = await contactsResponse.json();
                const signalsData = await signalsResponse.json();
                const partnershipsData = await partnershipsResponse.json();

                // Filter data for this account
                const accountContacts = contactsData.contacts?.filter(c =>
                    c.company_name === account.name
                ) || [];

                const accountSignals = signalsData.signals?.filter(s =>
                    account.name.toLowerCase() &&
                    s.event_description?.toLowerCase().includes(account.name.toLowerCase())
                ) || [];

                const accountPartnerships = partnershipsData.partnerships?.filter(p =>
                    p.target_company === account.name
                ) || [];

                // Update modal sections
                await updateContactsSection(accountContacts);
                await updateSignalsSection(accountSignals);
                await updatePartnershipsSection(accountPartnerships);
                await updateActionsSection(account, accountContacts, accountSignals);

            } catch (error) {
                console.error('Error loading account plan data:', error);
                showError('Failed to load account plan data');
            }
        }

        // Update contacts section in modal
        async function updateContactsSection(contacts) {
            const content = document.getElementById('account-contacts-content');
            const count = document.getElementById('contacts-count');

            count.textContent = `(${contacts.length})`;

            if (contacts.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; color: var(--verdigris-text-secondary); padding: 20px;">
                        <span>üì≠</span><br>
                        No contacts found for this account
                    </div>
                `;
                return;
            }

            // Sort by lead score
            const sortedContacts = contacts.sort((a, b) => (b.final_lead_score || 0) - (a.final_lead_score || 0));

            content.innerHTML = sortedContacts.map(contact => {
                const score = contact.final_lead_score || 0;
                const scoreClass = score >= 70 ? 'score-high' : score >= 50 ? 'score-medium' : 'score-low';

                return `
                    <div class="account-contact-item">
                        <div class="account-contact-name">${contact.full_name || 'Unknown'}</div>
                        <div class="account-contact-title">${contact.title || 'Unknown Role'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="account-contact-score ${scoreClass}">${score}% Score</span>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                ${contact.email ? `<a href="mailto:${contact.email}" style="font-size: 12px; color: var(--verdigris-primary); text-decoration: none;">üìß</a>` : ''}
                                ${contact.linkedin_url ? `<a href="${contact.linkedin_url}" target="_blank" style="font-size: 12px; color: var(--verdigris-primary); text-decoration: none;">üîó</a>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update signals section in modal
        async function updateSignalsSection(signals) {
            const content = document.getElementById('account-signals-content');
            const count = document.getElementById('signals-count');

            count.textContent = `(${signals.length})`;

            if (signals.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; color: var(--verdigris-text-secondary); padding: 20px;">
                        <span>üîç</span><br>
                        No buying signals detected yet
                    </div>
                `;
                return;
            }

            // Sort by urgency and timestamp
            const sortedSignals = signals.sort((a, b) => {
                const urgencyOrder = { 'High': 3, 'Medium': 2, 'Low': 1 };
                const urgencyDiff = (urgencyOrder[b.urgency_level] || 0) - (urgencyOrder[a.urgency_level] || 0);
                if (urgencyDiff !== 0) return urgencyDiff;
                return new Date(b.timestamp || 0) - new Date(a.timestamp || 0);
            });

            content.innerHTML = sortedSignals.map(signal => {
                const urgency = signal.urgency_level || 'Low';
                const urgencyClass = `signal-${urgency.toLowerCase()}`;

                return `
                    <div class="account-signal-item ${urgencyClass}">
                        <div class="account-signal-description">${signal.event_description || 'No description'}</div>
                        <div class="account-signal-meta">
                            <span style="color: ${urgency === 'High' ? '#ff4444' : urgency === 'Medium' ? '#ffaa00' : '#888'}">${urgency} Priority</span>
                            <span>${signal.confidence_score || 0}% Confidence</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update partnerships section in modal
        async function updatePartnershipsSection(partnerships) {
            const content = document.getElementById('account-partnerships-content');
            const count = document.getElementById('partnerships-count');

            count.textContent = `(${partnerships.length})`;

            if (partnerships.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; color: var(--verdigris-text-secondary); padding: 20px;">
                        <span>ü§ù</span><br>
                        No strategic partnerships identified
                    </div>
                `;
                return;
            }

            content.innerHTML = partnerships.map(partnership => `
                <div class="account-partnership-item">
                    <div class="account-partnership-type">${partnership.partnership_type || 'Unknown Type'}</div>
                    <div class="account-partnership-relevance">${partnership.verdigris_relevance || 'Relevance analysis pending'}</div>
                </div>
            `).join('');
        }

        // Update recommended actions section
        async function updateActionsSection(account, contacts, signals) {
            const content = document.getElementById('account-actions-content');
            const count = document.getElementById('actions-count');

            const actions = generateAccountActions(account, contacts, signals);
            count.textContent = `(${actions.length})`;

            if (actions.length === 0) {
                content.innerHTML = `
                    <div style="text-align: center; color: var(--verdigris-text-secondary); padding: 20px;">
                        <span>‚úÖ</span><br>
                        No immediate actions required
                    </div>
                `;
                return;
            }

            content.innerHTML = actions.map(action => {
                const priorityColor = action.priority === 'urgent' ? '#ff4444' :
                                     action.priority === 'high' ? 'var(--verdigris-primary)' : '#ffaa00';

                return `
                    <div style="background: var(--verdigris-surface-dark); border: 1px solid var(--verdigris-border-light); border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid ${priorityColor};">
                        <div style="font-weight: 600; color: var(--verdigris-text); margin-bottom: 4px;">
                            ${action.title}
                        </div>
                        <div style="font-size: 14px; color: var(--verdigris-text-secondary); margin-bottom: 8px;">
                            ${action.description}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: ${priorityColor}; font-weight: 600; text-transform: uppercase;">
                                ${action.priority} Priority
                            </span>
                            <span style="font-size: 12px; color: var(--verdigris-text-secondary);">
                                ${action.type}
                            </span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Generate recommended actions based on account data
        function generateAccountActions(account, contacts, signals) {
            const actions = [];

            // High-priority contacts without recent outreach
            const highValueContacts = contacts.filter(c => (c.final_lead_score || 0) >= 80);
            if (highValueContacts.length > 0) {
                actions.push({
                    type: 'outreach',
                    priority: 'high',
                    title: `Reach out to ${highValueContacts.length} high-value contact${highValueContacts.length > 1 ? 's' : ''}`,
                    description: `Top contact: ${highValueContacts[0].full_name || 'Unknown'} (${highValueContacts[0].final_lead_score || 0}% score)`
                });
            }

            // Recent high-urgency signals
            const urgentSignals = signals.filter(s => s.urgency_level === 'High');
            if (urgentSignals.length > 0) {
                actions.push({
                    type: 'signal_response',
                    priority: 'urgent',
                    title: `Respond to ${urgentSignals.length} urgent trigger event${urgentSignals.length > 1 ? 's' : ''}`,
                    description: urgentSignals[0].event_description?.slice(0, 100) + '...' || 'High-priority buying signal detected'
                });
            }

            // Low ICP fit score
            if ((account.icp_fit_score || 0) < 60) {
                actions.push({
                    type: 'research',
                    priority: 'medium',
                    title: 'Validate ICP fit',
                    description: `Current fit score: ${account.icp_fit_score || 0}% - conduct deeper research`
                });
            }

            // Missing research
            if (!account.research_completed) {
                actions.push({
                    type: 'research',
                    priority: 'medium',
                    title: 'Complete ABM research',
                    description: 'Run comprehensive account research to identify opportunities'
                });
            }

            return actions;
        }

        // Modal close on background click
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('account-plan-modal');
            if (event.target === modal) {
                closeAccountModal();
            }
        });

        // Modal close on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeAccountModal();
            }
        });

        console.log('‚úÖ Dashboard JavaScript initialized');
    </script>

    <!-- Account Plan Modal -->
    <div id="account-plan-modal" class="account-modal">
        <div class="account-modal-content">
            <div class="account-modal-header">
                <h1 id="account-modal-title" class="account-modal-title">
                    <span>üéØ</span>
                    <span id="account-modal-company-name">Account Intelligence</span>
                </h1>
                <button id="account-modal-close" class="account-modal-close" onclick="closeAccountModal()">
                    √ó
                </button>
            </div>
            <div class="account-modal-body">
                <div class="account-plan-content">
                    <!-- Account Overview Section -->
                    <div class="account-overview">
                        <div class="account-plan-section">
                            <h3 class="account-plan-section-title">
                                <span>üè¢</span>
                                Account Overview
                            </h3>
                            <div class="account-plan-section-content">
                                <div id="account-overview-content">
                                    <!-- Account details will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="account-plan-section">
                            <h3 class="account-plan-section-title">
                                <span>üìä</span>
                                ICP Fit Score
                            </h3>
                            <div class="account-plan-section-content">
                                <div class="account-stat-mini">
                                    <div id="account-icp-score" class="account-stat-value">--</div>
                                    <div class="account-stat-label">Fit Score</div>
                                </div>
                            </div>
                        </div>
                        <div class="account-plan-section">
                            <h3 class="account-plan-section-title">
                                <span>üî¨</span>
                                Research Status
                            </h3>
                            <div class="account-plan-section-content">
                                <div class="account-stat-mini">
                                    <div id="account-research-status" class="account-stat-value">--</div>
                                    <div class="account-stat-label">Status</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Priority Contacts Section -->
                    <div class="account-plan-section">
                        <h3 class="account-plan-section-title">
                            <span>üë•</span>
                            Priority Contacts
                            <span id="contacts-count" style="font-size: 14px; color: var(--verdigris-text-secondary); font-weight: normal;">--</span>
                        </h3>
                        <div class="account-plan-section-content">
                            <div id="account-contacts-content">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Buying Signals Section -->
                    <div class="account-plan-section">
                        <h3 class="account-plan-section-title">
                            <span>üö®</span>
                            Buying Signals
                            <span id="signals-count" style="font-size: 14px; color: var(--verdigris-text-secondary); font-weight: normal;">--</span>
                        </h3>
                        <div class="account-plan-section-content">
                            <div id="account-signals-content">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategic Partnerships Section -->
                    <div class="account-plan-section">
                        <h3 class="account-plan-section-title">
                            <span>ü§ù</span>
                            Strategic Partnerships
                            <span id="partnerships-count" style="font-size: 14px; color: var(--verdigris-text-secondary); font-weight: normal;">--</span>
                        </h3>
                        <div class="account-plan-section-content">
                            <div id="account-partnerships-content">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Next Actions Section -->
                    <div class="account-plan-section">
                        <h3 class="account-plan-section-title">
                            <span>üìã</span>
                            Recommended Actions
                            <span id="actions-count" style="font-size: 14px; color: var(--verdigris-text-secondary); font-weight: normal;">--</span>
                        </h3>
                        <div class="account-plan-section-content">
                            <div id="account-actions-content">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>